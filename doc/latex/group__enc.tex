\hypertarget{group__enc}{
\section{Function of Encoder AMT203}
\label{group__enc}\index{Function of Encoder AMT203@{Function of Encoder AMT203}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__enc_ga813c09cc4d9af8b357fe440a9438e685}{enc\_\-read\_\-pos} (int spi\_\-dev, unsigned short int $\ast$data)
\begin{DoxyCompactList}\small\item\em READ POSITION. \item\end{DoxyCompactList}\item 
int \hyperlink{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498}{enc\_\-zero\_\-set} (int spi\_\-dev)
\begin{DoxyCompactList}\small\item\em SET ZERO POINT. \item\end{DoxyCompactList}\item 
int \hyperlink{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}{enc\_\-wait\_\-for\_\-ack} (int spi\_\-dev, uint8\_\-t ack, int max\_\-errors)
\begin{DoxyCompactList}\small\item\em send command and delay between reads \item\end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{group__enc_ga813c09cc4d9af8b357fe440a9438e685}{
\index{enc@{enc}!enc\_\-read\_\-pos@{enc\_\-read\_\-pos}}
\index{enc\_\-read\_\-pos@{enc\_\-read\_\-pos}!enc@{enc}}
\subsubsection[{enc\_\-read\_\-pos}]{\setlength{\rightskip}{0pt plus 5cm}int enc\_\-read\_\-pos (int {\em spi\_\-dev}, \/  unsigned short int $\ast$ {\em data})}}
\label{group__enc_ga813c09cc4d9af8b357fe440a9438e685}


READ POSITION. 


\begin{DoxyParams}{Parameters}
\item[{\em spi\_\-dev}]Communication Port \item[\mbox{$\leftarrow$} {\em $\ast$data}]Data to read \end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with SUCCESS or FAILURE 
\end{DoxyReturn}


Check this function, in case of error put delay before each byte data



Definition at line 37 of file encoder\_\-functions.c.



References ARRAY\_\-SIZE, enc\_\-wait\_\-for\_\-ack(), ENCODER\_\-NO\_\-OP, ENCODER\_\-RD\_\-POS, FAILURE, INT\_\-MAX, spi\_\-trans\_\-bytes(), and SUCCESS.



Referenced by read\_\-all\_\-data().




\begin{DoxyCode}
37                                                       {
38 
39     uint8_t send[] = {ENCODER_RD_POS,ENCODER_NO_OP};
40     uint8_t receive[ARRAY_SIZE(send)] = {0, };
41     uint8_t buffer[ARRAY_SIZE(send)] = {0, } ;
42     
43     /* Send command */
44     spi_trans_bytes(spi_dev,send,receive,1);
45     if (enc_wait_for_ack(spi_dev, ENCODER_RD_POS, INT_MAX) != SUCCESS) { 
46         return FAILURE; 
47     }
48 
49     send[0]=ENCODER_NO_OP;
50 
51     if(spi_trans_bytes(spi_dev,send,receive,2) != SUCCESS) { 
52         return FAILURE; 
53     }
54 
55     buffer[0] = receive[0];
56 
60     if(spi_trans_bytes(spi_dev,send,receive,2) != SUCCESS) { 
61         return FAILURE; 
62     }
63 
64     buffer[1] = receive[0];
65 
66     *data = buffer[0]*256+buffer[1];
67 
68     //printf("\nreceive = 0x %2x %2x %d\n",buffer[0],buffer[1],data);
69 
70    return SUCCESS;
71 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}{
\index{enc@{enc}!enc\_\-wait\_\-for\_\-ack@{enc\_\-wait\_\-for\_\-ack}}
\index{enc\_\-wait\_\-for\_\-ack@{enc\_\-wait\_\-for\_\-ack}!enc@{enc}}
\subsubsection[{enc\_\-wait\_\-for\_\-ack}]{\setlength{\rightskip}{0pt plus 5cm}int enc\_\-wait\_\-for\_\-ack (int {\em spi\_\-dev}, \/  uint8\_\-t {\em ack}, \/  int {\em max\_\-errors})}}
\label{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}


send command and delay between reads 


\begin{DoxyParams}{Parameters}
\item[{\em spi\_\-dev}]Communication Dev \item[\mbox{$\leftarrow$} {\em data}]Data to write \end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with SUCCESS or FAILURE 
\end{DoxyReturn}


Definition at line 73 of file encoder\_\-functions.c.



References ENCODER\_\-NO\_\-OP, ENCODER\_\-WAIT\_\-RESP, FAILURE, spi\_\-trans\_\-bytes(), and SUCCESS.



Referenced by enc\_\-read\_\-pos(), and enc\_\-zero\_\-set().




\begin{DoxyCode}
74 {
75     int errors = 0;
76     uint8_t send = ENCODER_NO_OP;
77     uint8_t receive = 1;
78         
79   //nanosleep(10);
80         //spi_trans_bytes(spi_dev,send,receive,1);
81     while (receive != ack) {
82         spi_trans_bytes(spi_dev,&send,&receive,1);
83         //printf("\nReceive = 0x%x \n",receive);
84         if (receive != ENCODER_WAIT_RESP) {
85             errors++;
86             if (errors > max_errors) { return FAILURE; }
87         }
88     }
89 
90 
91     return SUCCESS;
92 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498}{
\index{enc@{enc}!enc\_\-zero\_\-set@{enc\_\-zero\_\-set}}
\index{enc\_\-zero\_\-set@{enc\_\-zero\_\-set}!enc@{enc}}
\subsubsection[{enc\_\-zero\_\-set}]{\setlength{\rightskip}{0pt plus 5cm}int enc\_\-zero\_\-set (int {\em spi\_\-dev})}}
\label{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498}


SET ZERO POINT. 


\begin{DoxyParams}{Parameters}
\item[{\em spi\_\-dev}]Communication Dev \item[\mbox{$\leftarrow$} {\em data}]Data to write\end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with SUCCESS or FAILURE 
\end{DoxyReturn}


Definition at line 19 of file encoder\_\-functions.c.



References enc\_\-wait\_\-for\_\-ack(), ENCODER\_\-EEPROM\_\-WR, ENCODER\_\-SET\_\-ZERO\_\-PT, FAILURE, INT\_\-MAX, spi\_\-trans\_\-bytes(), and SUCCESS.




\begin{DoxyCode}
19                              {
20 
21     uint8_t send = ENCODER_SET_ZERO_PT;
22     uint8_t receive = 0;
23     
24     /* Send command */
25     spi_trans_bytes(spi_dev,&send,&receive,1);
26     if (enc_wait_for_ack(spi_dev, ENCODER_EEPROM_WR, INT_MAX) != SUCCESS){ 
27         return FAILURE;
28     }
29 
30     /* Note: 
31      *   From datasheet, the encoder must be power-cycled after this command
32      *   for the new zero position to be used in the position calculation. */
33 
34     return SUCCESS;
35 }
\end{DoxyCode}




Here is the call graph for this function:

