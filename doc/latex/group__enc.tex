\hypertarget{group__enc}{\section{Function of Encoder A\-M\-T203}
\label{group__enc}\index{Function of Encoder A\-M\-T203@{Function of Encoder A\-M\-T203}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__enc_ga813c09cc4d9af8b357fe440a9438e685}{enc\-\_\-read\-\_\-pos} (int \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\-\_\-dev}, unsigned short int $\ast$data)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D P\-O\-S\-I\-T\-I\-O\-N. \end{DoxyCompactList}\item 
int \hyperlink{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498}{enc\-\_\-zero\-\_\-set} (int \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\-\_\-dev})
\begin{DoxyCompactList}\small\item\em S\-E\-T Z\-E\-R\-O P\-O\-I\-N\-T. \end{DoxyCompactList}\item 
int \hyperlink{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}{enc\-\_\-wait\-\_\-for\-\_\-ack} (int \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\-\_\-dev}, uint8\-\_\-t ack, int max\-\_\-errors)
\begin{DoxyCompactList}\small\item\em send command and delay between reads \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}


\subsection{Function Documentation}
\hypertarget{group__enc_ga813c09cc4d9af8b357fe440a9438e685}{\index{Function of Encoder A\-M\-T203@{Function of Encoder A\-M\-T203}!enc\-\_\-read\-\_\-pos@{enc\-\_\-read\-\_\-pos}}
\index{enc\-\_\-read\-\_\-pos@{enc\-\_\-read\-\_\-pos}!Function of Encoder AMT203@{Function of Encoder A\-M\-T203}}
\subsubsection[{enc\-\_\-read\-\_\-pos}]{\setlength{\rightskip}{0pt plus 5cm}int enc\-\_\-read\-\_\-pos (
\begin{DoxyParamCaption}
\item[{int}]{spi\-\_\-dev, }
\item[{unsigned short int $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{group__enc_ga813c09cc4d9af8b357fe440a9438e685}


R\-E\-A\-D P\-O\-S\-I\-T\-I\-O\-N. 


\begin{DoxyParams}[1]{Parameters}
 & {\em spi\-\_\-dev} & Communication Port \\
\hline
\mbox{\tt in}  & {\em $\ast$data} & Data to read \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with S\-U\-C\-C\-E\-S\-S or F\-A\-I\-L\-U\-R\-E 
\end{DoxyReturn}
T\-O\-D\-O Check this function, in case of error put delay before each byte data

Definition at line 37 of file encoder\-\_\-functions.\-c.



References enc\-\_\-wait\-\_\-for\-\_\-ack(), E\-N\-C\-O\-D\-E\-R\-\_\-\-N\-O\-\_\-\-O\-P, E\-N\-C\-O\-D\-E\-R\-\_\-\-R\-D\-\_\-\-P\-O\-S, F\-A\-I\-L\-U\-R\-E, I\-N\-T\-\_\-\-M\-A\-X, spi\-\_\-trans\-\_\-bytes(), and S\-U\-C\-C\-E\-S\-S.



Referenced by read\-\_\-all\-\_\-data().


\begin{DoxyCode}
                                                      \{

    uint8\_t send[] = \{\hyperlink{encoder__functions_8h_a24e6c0e05e904b10f56ae184da9e2aca}{ENCODER\_RD\_POS},\hyperlink{encoder__functions_8h_ac10b0f18ed2164776ad6843aa7908592}{ENCODER\_NO\_OP}\};
    uint8\_t receive[2] = \{0,\};
    
    \textcolor{comment}{/* Send command */}
    \hyperlink{communication_2spi__functions_8c_a3ae450d2b3ece27bb6036f811a7625a9}{spi\_trans\_bytes}(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev},send,receive,1);
    \textcolor{keywordflow}{if} (\hyperlink{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}{enc\_wait\_for\_ack}(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev}, \hyperlink{encoder__functions_8h_a24e6c0e05e904b10f56ae184da9e2aca}{ENCODER\_RD\_POS}
      , \hyperlink{encoder__functions_8h_a9ec306f36d50c7375e74f0d1c55a3a67}{INT\_MAX}) != \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS}) \{ 
        \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE}; 
    \}

    \textcolor{keywordflow}{if}(\hyperlink{communication_2spi__functions_8c_a3ae450d2b3ece27bb6036f811a7625a9}{spi\_trans\_bytes}(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev},send,receive,2) != \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS}
      ) \{ 
        \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE}; 
    \}

   data[0] = receive[0];
   data[1] = receive[1];

   \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};
\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{group__enc_ga813c09cc4d9af8b357fe440a9438e685_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{group__enc_ga813c09cc4d9af8b357fe440a9438e685_icgraph}
\end{center}
\end{figure}


\hypertarget{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}{\index{Function of Encoder A\-M\-T203@{Function of Encoder A\-M\-T203}!enc\-\_\-wait\-\_\-for\-\_\-ack@{enc\-\_\-wait\-\_\-for\-\_\-ack}}
\index{enc\-\_\-wait\-\_\-for\-\_\-ack@{enc\-\_\-wait\-\_\-for\-\_\-ack}!Function of Encoder AMT203@{Function of Encoder A\-M\-T203}}
\subsubsection[{enc\-\_\-wait\-\_\-for\-\_\-ack}]{\setlength{\rightskip}{0pt plus 5cm}int enc\-\_\-wait\-\_\-for\-\_\-ack (
\begin{DoxyParamCaption}
\item[{int}]{spi\-\_\-dev, }
\item[{uint8\-\_\-t}]{ack, }
\item[{int}]{max\-\_\-errors}
\end{DoxyParamCaption}
)}}\label{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}


send command and delay between reads 


\begin{DoxyParams}[1]{Parameters}
 & {\em spi\-\_\-dev} & Communication Dev \\
\hline
\mbox{\tt in}  & {\em data} & Data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with S\-U\-C\-C\-E\-S\-S or F\-A\-I\-L\-U\-R\-E 
\end{DoxyReturn}


Definition at line 61 of file encoder\-\_\-functions.\-c.



References E\-N\-C\-O\-D\-E\-R\-\_\-\-N\-O\-\_\-\-O\-P, E\-N\-C\-O\-D\-E\-R\-\_\-\-W\-A\-I\-T\-\_\-\-R\-E\-S\-P, F\-A\-I\-L\-U\-R\-E, spi\-\_\-trans\-\_\-bytes(), and S\-U\-C\-C\-E\-S\-S.



Referenced by enc\-\_\-read\-\_\-pos(), and enc\-\_\-zero\-\_\-set().


\begin{DoxyCode}
\{
    \textcolor{keywordtype}{int} errors = 0;
    uint8\_t send = \hyperlink{encoder__functions_8h_ac10b0f18ed2164776ad6843aa7908592}{ENCODER\_NO\_OP};
    uint8\_t receive = 0;
        
  \textcolor{comment}{//nanosleep(10);}
        \textcolor{comment}{//spi\_trans\_bytes(spi\_dev,send,receive,1);}
    \textcolor{keywordflow}{while} (receive != ack) \{
        \hyperlink{communication_2spi__functions_8c_a3ae450d2b3ece27bb6036f811a7625a9}{spi\_trans\_bytes}(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev},&send,&receive,1);
        \textcolor{keywordflow}{if} (receive != \hyperlink{encoder__functions_8h_a77c3a97f7312d858d04ec3b4e1fb2176}{ENCODER\_WAIT\_RESP}) \{
            errors++;
            \textcolor{keywordflow}{if} (errors > max\_errors) \{ \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE}; \}
        \}
    \}

    \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};
\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=296pt]{group__enc_gad82fb44f2e735628ec95e003e4a1f93c_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{group__enc_gad82fb44f2e735628ec95e003e4a1f93c_icgraph}
\end{center}
\end{figure}


\hypertarget{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498}{\index{Function of Encoder A\-M\-T203@{Function of Encoder A\-M\-T203}!enc\-\_\-zero\-\_\-set@{enc\-\_\-zero\-\_\-set}}
\index{enc\-\_\-zero\-\_\-set@{enc\-\_\-zero\-\_\-set}!Function of Encoder AMT203@{Function of Encoder A\-M\-T203}}
\subsubsection[{enc\-\_\-zero\-\_\-set}]{\setlength{\rightskip}{0pt plus 5cm}int enc\-\_\-zero\-\_\-set (
\begin{DoxyParamCaption}
\item[{int}]{spi\-\_\-dev}
\end{DoxyParamCaption}
)}}\label{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498}


S\-E\-T Z\-E\-R\-O P\-O\-I\-N\-T. 


\begin{DoxyParams}[1]{Parameters}
 & {\em spi\-\_\-dev} & Communication Dev \\
\hline
\mbox{\tt in}  & {\em data} & Data to write\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with S\-U\-C\-C\-E\-S\-S or F\-A\-I\-L\-U\-R\-E 
\end{DoxyReturn}


Definition at line 19 of file encoder\-\_\-functions.\-c.



References enc\-\_\-wait\-\_\-for\-\_\-ack(), E\-N\-C\-O\-D\-E\-R\-\_\-\-E\-E\-P\-R\-O\-M\-\_\-\-W\-R, E\-N\-C\-O\-D\-E\-R\-\_\-\-S\-E\-T\-\_\-\-Z\-E\-R\-O\-\_\-\-P\-T, F\-A\-I\-L\-U\-R\-E, I\-N\-T\-\_\-\-M\-A\-X, spi\-\_\-trans\-\_\-bytes(), and S\-U\-C\-C\-E\-S\-S.


\begin{DoxyCode}
                             \{

    uint8\_t send = \hyperlink{encoder__functions_8h_aa2fec4e0eb5a7b3668158a57952b9dbe}{ENCODER\_SET\_ZERO\_PT};
    uint8\_t receive = 0;
    
    \textcolor{comment}{/* Send command */}
    \hyperlink{communication_2spi__functions_8c_a3ae450d2b3ece27bb6036f811a7625a9}{spi\_trans\_bytes}(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev},&send,&receive,1);
    \textcolor{keywordflow}{if} (\hyperlink{group__enc_gad82fb44f2e735628ec95e003e4a1f93c}{enc\_wait\_for\_ack}(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev}, \hyperlink{encoder__functions_8h_ab815abd4b9b825c60dbb04aad0d0e846}{ENCODER\_EEPROM\_WR}
      , \hyperlink{encoder__functions_8h_a9ec306f36d50c7375e74f0d1c55a3a67}{INT\_MAX}) != \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS})\{ 
        \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE};
    \}

    \textcolor{comment}{/* Note: }
\textcolor{comment}{     *   From datasheet, the encoder must be power-cycled after this command}
\textcolor{comment}{     *   for the new zero position to be used in the position calculation. */}

    \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};
\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{group__enc_gaebbe7b9d3c2571f7481cefacbe36c498_cgraph}
\end{center}
\end{figure}


