\hypertarget{group__mag}{\section{Functions to Magnetometer H\-M\-C5883}
\label{group__mag}\index{Functions to Magnetometer H\-M\-C5883@{Functions to Magnetometer H\-M\-C5883}}
}
Collaboration diagram for Functions to Magnetometer H\-M\-C5883\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=326pt]{group__mag}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint8\-\_\-t $\ast$ \hyperlink{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{mag\-\_\-read\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t count)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E. \end{DoxyCompactList}\item 
int \hyperlink{group__mag_gab42ae0d0a2a6f37cf36d856c072b7f34}{mag\-\_\-read\-\_\-all\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, short int $\ast$data)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y and Z) \end{DoxyCompactList}\item 
short int \hyperlink{group__mag_ga542a31ccd07cd2c3e8e2b68cdb6d219e}{mag\-\_\-read\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, int axis)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D D\-A\-T\-A (X, Y or Z) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}


\subsection{Function Documentation}
\hypertarget{group__mag_gab42ae0d0a2a6f37cf36d856c072b7f34}{\index{Functions to Magnetometer H\-M\-C5883@{Functions to Magnetometer H\-M\-C5883}!mag\-\_\-read\-\_\-all\-\_\-data@{mag\-\_\-read\-\_\-all\-\_\-data}}
\index{mag\-\_\-read\-\_\-all\-\_\-data@{mag\-\_\-read\-\_\-all\-\_\-data}!Functions to Magnetometer HMC5883@{Functions to Magnetometer H\-M\-C5883}}
\subsubsection[{mag\-\_\-read\-\_\-all\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}int mag\-\_\-read\-\_\-all\-\_\-data (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{short int $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{group__mag_gab42ae0d0a2a6f37cf36d856c072b7f34}


R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y and Z) 


\begin{DoxyParams}[1]{Parameters}
 & {\em i2c\-\_\-dev} & \\
\hline
\mbox{\tt out}  & {\em $\ast$data} & \\
\hline
\end{DoxyParams}


Definition at line 121 of file mag\-\_\-functions.\-c.



Referenced by read\-\_\-all\-\_\-data().


\begin{DoxyCode}
122 \{
123   uint8\_t i, j;
124   uint8\_t *data8;
125   \textcolor{keyword}{union }result
126   \{
127     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \textcolor{keywordtype}{int} usgnd[3];
128     \textcolor{keywordtype}{short} \textcolor{keywordtype}{int} sgnd[3];
129   \} result;
130   \textcolor{comment}{//result=(union result*)malloc(3*sizeof(union result));}
131   \textcolor{keywordflow}{if}( (data8=\hyperlink{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_a4f883328e7ae117996e334145ddd0032}{MAG\_DATAX1},6))==NULL)
132   \{
133     \textcolor{comment}{//perror("Read accelerometer register failed");}
134     \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE};
135   \}
136   \textcolor{comment}{//result.usgnd=(unsigned int*)malloc(3*sizeof(unsigned int));}
137   j=0;
138   \textcolor{keywordflow}{for}(i=0; i<3; i++)
139   \{
140     result.usgnd[j]=0;
141     result.usgnd[j]=result.usgnd[j]|((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} int)data8[i*2+1])|(((\textcolor{keywordtype}{unsigned} int)data8[i*2])<<8);
142     data[j]=result.sgnd[j];
143     j=2-i; \textcolor{comment}{// trick used to change the sorting of the data from XZY to XYZ}
144   \}
145   \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};  
146 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{group__mag_gab42ae0d0a2a6f37cf36d856c072b7f34_icgraph}
\end{center}
\end{figure}


\hypertarget{group__mag_ga542a31ccd07cd2c3e8e2b68cdb6d219e}{\index{Functions to Magnetometer H\-M\-C5883@{Functions to Magnetometer H\-M\-C5883}!mag\-\_\-read\-\_\-data@{mag\-\_\-read\-\_\-data}}
\index{mag\-\_\-read\-\_\-data@{mag\-\_\-read\-\_\-data}!Functions to Magnetometer HMC5883@{Functions to Magnetometer H\-M\-C5883}}
\subsubsection[{mag\-\_\-read\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}short int mag\-\_\-read\-\_\-data (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{int}]{axis}
\end{DoxyParamCaption}
)}}\label{group__mag_ga542a31ccd07cd2c3e8e2b68cdb6d219e}


R\-E\-A\-D D\-A\-T\-A (X, Y or Z) 


\begin{DoxyParams}{Parameters}
{\em i2c\-\_\-dev} & \\
\hline
{\em axis} & set the axis ('X' or 'Y' or 'Z') \\
\hline
\end{DoxyParams}


Definition at line 148 of file mag\-\_\-functions.\-c.


\begin{DoxyCode}
149 \{
150   uint8\_t *data;
151   \textcolor{keyword}{union }result
152   \{
153     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} usgnd;
154     \textcolor{keywordtype}{int} sgnd;
155   \}result;
156 
157   \textcolor{keywordflow}{switch}(axis)\{
158     \textcolor{keywordflow}{case} \textcolor{charliteral}{'X'}:
159       data=\hyperlink{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_a4f883328e7ae117996e334145ddd0032}{MAG\_DATAX1},2);
160       \textcolor{keywordflow}{break};
161     \textcolor{keywordflow}{case} \textcolor{charliteral}{'Y'}:
162       data=\hyperlink{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_ae218906702b1e40c2b6970f97dd0cfe4}{MAG\_DATAY1},2);
163       \textcolor{keywordflow}{break};
164     \textcolor{keywordflow}{case} \textcolor{charliteral}{'Z'}:
165       data=\hyperlink{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_a81d7d9236ec69a1a229e4fa7c6299fde}{MAG\_DATAZ1},2);
166       \textcolor{keywordflow}{break};
167     \textcolor{keywordflow}{default}:
168       \textcolor{comment}{//perror("Wrong argument for axis in mag\_read\_data");}
169       \textcolor{keywordflow}{return} -1;
170   \}
171   result.usgnd=0;
172   result.usgnd=result.usgnd|(((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} int)data[1]))|(((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \textcolor{keywordtype}{int})data[0])<<8);
173   \textcolor{keywordflow}{return} result.sgnd;
174 \}
\end{DoxyCode}
\hypertarget{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{\index{Functions to Magnetometer H\-M\-C5883@{Functions to Magnetometer H\-M\-C5883}!mag\-\_\-read\-\_\-reg@{mag\-\_\-read\-\_\-reg}}
\index{mag\-\_\-read\-\_\-reg@{mag\-\_\-read\-\_\-reg}!Functions to Magnetometer HMC5883@{Functions to Magnetometer H\-M\-C5883}}
\subsubsection[{mag\-\_\-read\-\_\-reg}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t$\ast$ mag\-\_\-read\-\_\-reg (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{uint8\-\_\-t}]{reg, }
\item[{uint8\-\_\-t}]{count}
\end{DoxyParamCaption}
)}}\label{group__mag_ga6830eaeae2298320e1e8c902e4edd709}


R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E. 


\begin{DoxyParams}{Parameters}
{\em i2c\-\_\-dev} & \\
\hline
{\em reg} & \\
\hline
{\em count} & number of registers in sequence (1-\/13) \\
\hline
\end{DoxyParams}


Definition at line 31 of file mag\-\_\-functions.\-c.



Referenced by mag\-\_\-read\-\_\-all\-\_\-data(), and mag\-\_\-read\-\_\-data().


\begin{DoxyCode}
32 \{
33   uint8\_t data[13];
34   \textcolor{keywordtype}{int} i;
35 
36   \textcolor{comment}{//data=(uint8\_t*)malloc((count+1)*sizeof(data));}
37   
38   data[0] = reg;
39 
40   \textcolor{keywordflow}{if} (write(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, &data, 1) != 1) \{            
41         \textcolor{comment}{//perror("write before read");}
42         \textcolor{keywordflow}{return} NULL;
43   \}
44   data[0] = 0;
45   \textcolor{keywordflow}{if} (read(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, &data, count) != count) \{
46         \textcolor{comment}{//perror("read");}
47         \textcolor{keywordflow}{return} NULL;    
48   \}
49 
50   \textcolor{keywordflow}{return} data;
51 \}
\end{DoxyCode}


Here is the caller graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=292pt]{group__mag_ga6830eaeae2298320e1e8c902e4edd709_icgraph}
\end{center}
\end{figure}


