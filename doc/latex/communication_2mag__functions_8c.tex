\hypertarget{communication_2mag__functions_8c}{\section{communication/mag\-\_\-functions.c File Reference}
\label{communication_2mag__functions_8c}\index{communication/mag\-\_\-functions.\-c@{communication/mag\-\_\-functions.\-c}}
}
{\ttfamily \#include \char`\"{}imu\-\_\-functions.\-h\char`\"{}}\\*
Include dependency graph for mag\-\_\-functions.\-c\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{communication_2mag__functions_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__imu_gab5d0ae421cd4bb10b1b7a1eda167416b}{mag\-\_\-write\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t data)
\begin{DoxyCompactList}\small\item\em Rev 0 -\/ 11/11/2012 R\-L\-E\-G project -\/ 2012. \end{DoxyCompactList}\item 
uint8\-\_\-t $\ast$ \hyperlink{group__mag_ga6830eaeae2298320e1e8c902e4edd709}{mag\-\_\-read\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t count)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E. \end{DoxyCompactList}\item 
int \hyperlink{communication_2mag__functions_8c_a014f908c9faa37c1ec75177a17012a01}{mag\-\_\-init} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t rate, uint8\-\_\-t range, uint8\-\_\-t samples\-\_\-avg, uint8\-\_\-t meas\-\_\-mode, uint8\-\_\-t op\-\_\-mode)
\begin{DoxyCompactList}\small\item\em I\-N\-I\-T\-I\-A\-L\-I\-Z\-E M\-A\-G\-N\-E\-T\-O\-M\-E\-T\-E\-R. \end{DoxyCompactList}\item 
int \hyperlink{group__mag_gab42ae0d0a2a6f37cf36d856c072b7f34}{mag\-\_\-read\-\_\-all\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, short int $\ast$data)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y and Z) \end{DoxyCompactList}\item 
short int \hyperlink{group__mag_ga542a31ccd07cd2c3e8e2b68cdb6d219e}{mag\-\_\-read\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, int axis)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D D\-A\-T\-A (X, Y or Z) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{communication_2mag__functions_8c_a014f908c9faa37c1ec75177a17012a01}{\index{communication/mag\-\_\-functions.\-c@{communication/mag\-\_\-functions.\-c}!mag\-\_\-init@{mag\-\_\-init}}
\index{mag\-\_\-init@{mag\-\_\-init}!communication/mag_functions.c@{communication/mag\-\_\-functions.\-c}}
\subsubsection[{mag\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int mag\-\_\-init (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{uint8\-\_\-t}]{rate, }
\item[{uint8\-\_\-t}]{range, }
\item[{uint8\-\_\-t}]{samples\-\_\-avg, }
\item[{uint8\-\_\-t}]{meas\-\_\-mode, }
\item[{uint8\-\_\-t}]{op\-\_\-mode}
\end{DoxyParamCaption}
)}}\label{communication_2mag__functions_8c_a014f908c9faa37c1ec75177a17012a01}


I\-N\-I\-T\-I\-A\-L\-I\-Z\-E M\-A\-G\-N\-E\-T\-O\-M\-E\-T\-E\-R. 



Definition at line 53 of file mag\-\_\-functions.\-c.


\begin{DoxyCode}
54 \{ 
55   uint8\_t data=0;
56 
57   \textcolor{keywordflow}{switch}(rate)\{
58     \textcolor{keywordflow}{case} 15:
59       data=0x10;
60       \textcolor{keywordflow}{break};
61     \textcolor{keywordflow}{case} 0:
62       data=0x00;
63       \textcolor{keywordflow}{break};
64     \textcolor{keywordflow}{case} 1:
65       data=0x04;
66       \textcolor{keywordflow}{break};
67     \textcolor{keywordflow}{case} 3:
68       data=0x08;
69       \textcolor{keywordflow}{break};
70     \textcolor{keywordflow}{case} 7:
71       data=0x0C;
72       \textcolor{keywordflow}{break};
73     \textcolor{keywordflow}{case} 30:
74       data=0x14;
75       \textcolor{keywordflow}{break};
76     \textcolor{keywordflow}{case} 75:
77       data=0x18;
78       \textcolor{keywordflow}{break};
79     \textcolor{keywordflow}{default}:
80       perror(\textcolor{stringliteral}{"Wrong rate value"});
81       \textcolor{keywordflow}{break};
82   \}
83   
84   \textcolor{keywordflow}{switch}(samples\_avg)\{
85     \textcolor{keywordflow}{case} 8:
86       data=data|0x60;
87       \textcolor{keywordflow}{break};
88     \textcolor{keywordflow}{case} 1:
89       \textcolor{keywordflow}{break};
90     \textcolor{keywordflow}{case} 2:
91       data=data|0x20;
92       \textcolor{keywordflow}{break};
93     \textcolor{keywordflow}{case} 4:
94       data=data|0x40;
95       \textcolor{keywordflow}{break};
96     \textcolor{keywordflow}{default}:
97       perror(\textcolor{stringliteral}{"Wrong samples\_avg value"});
98       \textcolor{keywordflow}{break};
99   \}
100   
101   data+=meas\_mode;
102   
103   \textcolor{keywordflow}{if}(\hyperlink{group__imu_gab5d0ae421cd4bb10b1b7a1eda167416b}{mag\_write\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{communication_2imu__regs_8h_a4c80cd6ce866f16a3d999ee2c5635ec9}{MAG\_CONFIG\_A}, data)<0)\{
104     perror(\textcolor{stringliteral}{"Write in Configuration register A unsuccesful"});
105     \textcolor{keywordflow}{return} -1;
106   \}
107   
108   \textcolor{keywordflow}{if}(\hyperlink{group__imu_gab5d0ae421cd4bb10b1b7a1eda167416b}{mag\_write\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{communication_2imu__regs_8h_a094173f77219df894d97eed44405d942}{MAG\_CONFIG\_B}, range<<5)<0)\{
109     perror(\textcolor{stringliteral}{"Write in configuration register B unsuccesful"});
110     \textcolor{keywordflow}{return} -1;
111   \}
112   
113   \textcolor{keywordflow}{if}(\hyperlink{group__imu_gab5d0ae421cd4bb10b1b7a1eda167416b}{mag\_write\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{communication_2imu__regs_8h_a0173afba6efc0e164495bf506a9758d2}{MAG\_MODE}, op\_mode)<0)\{
114     perror(\textcolor{stringliteral}{"Write in mode register unsuccesful"});
115     \textcolor{keywordflow}{return} -1;
116   \}
117   
118   \textcolor{keywordflow}{return} 1;
119 \}
\end{DoxyCode}
