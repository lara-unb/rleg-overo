\hypertarget{taskScheduler_8c}{\section{task\-Scheduler.\-c File Reference}
\label{taskScheduler_8c}\index{task\-Scheduler.\-c@{task\-Scheduler.\-c}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{taskScheduler_8c_a2656ac374f671881cf9ae0ff4dc229ba}{timer\-\_\-new\-\_\-task} (\hyperlink{structTASK__S}{T\-A\-S\-K\-\_\-\-S} $\ast$task, void($\ast$run\-Funtion)(void))
\item 
void \hyperlink{taskScheduler_8c_ac088a054258396a6e2dba77908f22b42}{timer\-\_\-start\-\_\-task} (\hyperlink{structTASK__S}{T\-A\-S\-K\-\_\-\-S} $\ast$task)
\begin{DoxyCompactList}\small\item\em Start some task. \end{DoxyCompactList}\item 
void \hyperlink{taskScheduler_8c_a39e4b92cd20da5838951ab5b0ad19fbb}{timer\-\_\-function\-\_\-task} (\hyperlink{structTASK__S}{T\-A\-S\-K\-\_\-\-S} $\ast$task)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{taskScheduler_8c_a39e4b92cd20da5838951ab5b0ad19fbb}{\index{task\-Scheduler.\-c@{task\-Scheduler.\-c}!timer\-\_\-function\-\_\-task@{timer\-\_\-function\-\_\-task}}
\index{timer\-\_\-function\-\_\-task@{timer\-\_\-function\-\_\-task}!taskScheduler.c@{task\-Scheduler.\-c}}
\subsubsection[{timer\-\_\-function\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}void timer\-\_\-function\-\_\-task (
\begin{DoxyParamCaption}
\item[{{\bf T\-A\-S\-K\-\_\-\-S} $\ast$}]{task}
\end{DoxyParamCaption}
)}}\label{taskScheduler_8c_a39e4b92cd20da5838951ab5b0ad19fbb}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000003}{Todo}]make a function to set all times to zero \end{DoxyRefDesc}


Definition at line 47 of file task\-Scheduler.\-c.



References status, and t0.


\begin{DoxyCode}
\{
  \textcolor{keywordtype}{int} \hyperlink{communication_2communication_8c_a6e27f49150e9a14580fb313cc2777e00}{status} = 0;
  \textcolor{keyword}{static} \textcolor{keyword}{struct }timeval timereset;
  \textcolor{keyword}{static} \textcolor{keyword}{struct }timeval time;
  \textcolor{keyword}{static} \textcolor{keyword}{struct }timeval time\_exec\_start;
  \textcolor{keyword}{static} \textcolor{keyword}{struct }timeval time\_exec\_end;
  \textcolor{keyword}{static} \textcolor{keywordtype}{double} T\_task,t\_task,t\_task\_previous;
  \textcolor{keyword}{static} \textcolor{keywordtype}{double} T\_task\_mean,T\_task\_min,T\_task\_max,T\_task\_exec;

  gettimeofday(&time\_exec\_start, NULL);

  \textcolor{comment}{// Time calculation}
  \textcolor{keywordflow}{if}((*task).isFirstExecution)
    \{
      gettimeofday(&timereset, NULL);
    \}

  gettimeofday(&time, NULL);
  t\_task = ((time.tv\_sec - timereset.tv\_sec) + (time.tv\_usec - timereset.
      tv\_usec)*1e-6);
  T\_task = t\_task - t\_task\_previous;
  t\_task\_previous = t\_task;

  \textcolor{keywordflow}{if}((*task).isFirstExecution)
    \{
      T\_task\_mean = T\_task;
      T\_task\_min  = 1e200;
      T\_task\_max  = 0.0;
      \hyperlink{main2_8c_a86c2efd6da48b362806cdbb5b1e711d8}{t0} = t\_task;
    \}
  \textcolor{keywordflow}{else}
    \{
      T\_task\_mean = 0.05*T\_task + 0.95*T\_task\_mean;
      \textcolor{keywordflow}{if}(T\_task < T\_task\_min) T\_task\_min  = T\_task;
      \textcolor{keywordflow}{if}(T\_task > T\_task\_max) T\_task\_max  = T\_task;
    \}

  \textcolor{comment}{// Run the thread}
  status = (*task).runFunction();

  gettimeofday(&time\_exec\_end, NULL);
  T\_task\_exec = ((time\_exec\_end.tv\_sec - time\_exec\_start.tv\_sec) + (
      time\_exec\_end.tv\_usec - time\_exec\_start.tv\_usec)*1e-6);

  (*task).t\_global = t\_task;
  (*task).T\_mean\_global = T\_task\_mean;
  (*task).T\_min\_global = T\_task\_min;
  (*task).T\_max\_global = T\_task\_max;
  (*task).T\_exec\_global = T\_task\_exec;

  (*task).isFirstExecution = 0;
\}
\end{DoxyCode}
\hypertarget{taskScheduler_8c_a2656ac374f671881cf9ae0ff4dc229ba}{\index{task\-Scheduler.\-c@{task\-Scheduler.\-c}!timer\-\_\-new\-\_\-task@{timer\-\_\-new\-\_\-task}}
\index{timer\-\_\-new\-\_\-task@{timer\-\_\-new\-\_\-task}!taskScheduler.c@{task\-Scheduler.\-c}}
\subsubsection[{timer\-\_\-new\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}void timer\-\_\-new\-\_\-task (
\begin{DoxyParamCaption}
\item[{{\bf T\-A\-S\-K\-\_\-\-S} $\ast$}]{task, }
\item[{void($\ast$)(void)}]{run\-Funtion}
\end{DoxyParamCaption}
)}}\label{taskScheduler_8c_a2656ac374f671881cf9ae0ff4dc229ba}


Definition at line 5 of file task\-Scheduler.\-c.



References T\-A\-S\-K\-\_\-\-S\-::run\-Function.


\begin{DoxyCode}
                                                          \{
  (*task).t\_global = 0.0;
  (*task).T\_exec\_global = 0.0;
  (*task).T\_mean\_global = 0.0;
  (*task).T\_max\_global = 0.0;
  (*task).period\_us = 0.0;
  (*task).isFirstExecution = 1;

  task->\hyperlink{structTASK__S_a241d427891bed303812b78bd9f9ad86f}{runFunction} = runFunction;
\}
\end{DoxyCode}
\hypertarget{taskScheduler_8c_ac088a054258396a6e2dba77908f22b42}{\index{task\-Scheduler.\-c@{task\-Scheduler.\-c}!timer\-\_\-start\-\_\-task@{timer\-\_\-start\-\_\-task}}
\index{timer\-\_\-start\-\_\-task@{timer\-\_\-start\-\_\-task}!taskScheduler.c@{task\-Scheduler.\-c}}
\subsubsection[{timer\-\_\-start\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}void timer\-\_\-start\-\_\-task (
\begin{DoxyParamCaption}
\item[{{\bf T\-A\-S\-K\-\_\-\-S} $\ast$}]{task}
\end{DoxyParamCaption}
)}}\label{taskScheduler_8c_ac088a054258396a6e2dba77908f22b42}


Start some task. 



Definition at line 16 of file task\-Scheduler.\-c.



References f\-\_\-timer\-\_\-task\-\_\-1().


\begin{DoxyCode}
                                   \{
  \textcolor{keyword}{struct }itimerspec itimer;
  \textcolor{keyword}{struct }sigevent sigev;
  \textcolor{keywordtype}{int} erno = 0;

  (*task).isFirstExecution = 1;

  itimer.it\_interval.tv\_sec = 0;
  itimer.it\_interval.tv\_nsec= (*task).period\_us*1000;
  itimer.it\_value = itimer.it\_interval;

  memset(&sigev,0,\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} sigevent));

  sigev.sigev\_value.sival\_int = 0;
  sigev.sigev\_notify = SIGEV\_THREAD;
  sigev.sigev\_notify\_attributes = NULL;
  sigev.sigev\_notify\_function = \hyperlink{main2_8c_a5ce2b6a7dd4d00c90fe18098091044aa}{f\_timer\_task\_1};

  \textcolor{keywordflow}{if} (timer\_create(CLOCK\_REALTIME, &sigev, &((*task).timer)) < 0)
  \{
    fprintf(stderr, \textcolor{stringliteral}{"[%d]: %s\(\backslash\)n"}, \_\_LINE\_\_, strerror(erno));
    exit(erno);
  \}

  \textcolor{keywordflow}{if}(timer\_settime((*task).timer,0,&itimer,NULL) < 0)
  \{
    fprintf(stderr,\textcolor{stringliteral}{"[%d]: %s\(\backslash\)n"}, \_\_LINE\_\_, strerror(erno));
    exit(erno);
  \}
\}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{taskScheduler_8c_ac088a054258396a6e2dba77908f22b42_cgraph}
\end{center}
\end{figure}


