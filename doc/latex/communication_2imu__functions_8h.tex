\hypertarget{communication_2imu__functions_8h}{\section{communication/imu\-\_\-functions.h File Reference}
\label{communication_2imu__functions_8h}\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}}
}
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdint.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$string.\-h$>$}\\*
{\ttfamily \#include $<$errno.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$sys/types.\-h$>$}\\*
{\ttfamily \#include $<$sys/stat.\-h$>$}\\*
{\ttfamily \#include $<$sys/ioctl.\-h$>$}\\*
{\ttfamily \#include $<$fcntl.\-h$>$}\\*
{\ttfamily \#include $<$linux/i2c-\/dev.\-h$>$}\\*
{\ttfamily \#include \char`\"{}imu\-\_\-regs.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{communication_2imu__functions_8h_aa3f75ad2972ec8996ce5206feac0e52c}{A\-S\-C\-I\-I\-\_\-0}~0x30
\item 
\#define \hyperlink{communication_2imu__functions_8h_aa90cac659d18e8ef6294c7ae337f6b58}{S\-U\-C\-C\-E\-S\-S}~1
\item 
\#define \hyperlink{communication_2imu__functions_8h_a6d58f9ac447476b4e084d7ca383f5183}{F\-A\-I\-L\-U\-R\-E}~-\/1
\item 
\#define \hyperlink{communication_2imu__functions_8h_a909f4a5773e20e672cdb4088e1cfa22f}{A\-D\-D\-\_\-\-A\-D\-X\-L345}~0x53
\item 
\#define \hyperlink{communication_2imu__functions_8h_ab9fd1068a3f5fcba24d92918aaf0dcb5}{A\-D\-D\-\_\-\-I\-T\-G3200}~0x68
\item 
\#define \hyperlink{communication_2imu__functions_8h_a383c09d3e3bbe30097f7eb8d081fb856}{A\-D\-D\-\_\-\-H\-M\-C5883}~0x1\-E
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__acc_ga534116416343122de29a5b6ade6876bd}{acc\-\_\-write\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t data)
\begin{DoxyCompactList}\small\item\em W\-R\-I\-T\-E T\-O R\-E\-G\-I\-S\-T\-E\-R. \end{DoxyCompactList}\item 
uint8\-\_\-t $\ast$ \hyperlink{group__acc_ga2a91c44eebbe44f4d3b8c508633512f9}{acc\-\_\-read\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t count)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E \end{DoxyCompactList}\item 
int \hyperlink{group__acc_gae8f9cc6e0d15e61039d846305f86f073}{acc\-\_\-init} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t full\-\_\-res, uint16\-\_\-t rate, uint8\-\_\-t range)
\begin{DoxyCompactList}\small\item\em I\-N\-I\-T\-I\-A\-L\-I\-Z\-E A\-C\-C\-E\-L\-E\-R\-O\-M\-E\-T\-E\-R. \end{DoxyCompactList}\item 
int \hyperlink{group__acc_ga013bb5ed8a763883fc440549d2b1a6ce}{acc\-\_\-read\-\_\-all\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, short int $\ast$data)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y and Z) \end{DoxyCompactList}\item 
short int \hyperlink{group__acc_ga041d6953f2bfc8c5efa4d5bbac812305}{acc\-\_\-read\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, int axis)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D D\-A\-T\-A (X, Y or Z) \end{DoxyCompactList}\item 
char $\ast$ \hyperlink{communication_2imu__functions_8h_a1a6b2f719b4fef8f97d6d1b8f495148e}{conv\-\_\-byte\-\_\-hex\-\_\-bin} (uint8\-\_\-t $\ast$hvalue)
\item 
int \hyperlink{group__acc_ga8509cccabb08e7267677f66f25718731}{acc\-\_\-read\-\_\-all\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev})
\begin{DoxyCompactList}\small\item\em Read all accelerometer data and print in stdio. \end{DoxyCompactList}\item 
int \hyperlink{group__gyr_ga3eba167b8ab0614bfe7bafeae8b5570d}{gyr\-\_\-write\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t data)
\begin{DoxyCompactList}\small\item\em W\-R\-I\-T\-E T\-O R\-E\-G\-I\-S\-T\-E\-R. \end{DoxyCompactList}\item 
uint8\-\_\-t $\ast$ \hyperlink{group__gyr_gad817a3b69d4c3026b7a9b6de32753e7b}{gyr\-\_\-read\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t count)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E. \end{DoxyCompactList}\item 
int \hyperlink{group__gyr_ga6d02be352b4491a236c9695a6a24d174}{gyr\-\_\-init} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, float rate, short int lpf\-\_\-bw, char clk\-\_\-source, char $\ast$act)
\begin{DoxyCompactList}\small\item\em I\-N\-I\-T\-I\-A\-L\-I\-Z\-E G\-Y\-R\-O\-M\-E\-T\-E\-R. \end{DoxyCompactList}\item 
int \hyperlink{group__gyr_ga79875465c3a29fd9ec77308c80a8bc37}{gyr\-\_\-read\-\_\-all\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, short int $\ast$data)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y, Z and T) \end{DoxyCompactList}\item 
short int \hyperlink{group__gyr_ga271b37e9ace81b18bb2f83787247d262}{gyr\-\_\-read\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, int type)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D D\-A\-T\-A (X, Y, Z or T) \end{DoxyCompactList}\item 
int \hyperlink{communication_2imu__functions_8h_ab5d0ae421cd4bb10b1b7a1eda167416b}{mag\-\_\-write\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t data)
\begin{DoxyCompactList}\small\item\em W\-R\-I\-T\-E T\-O R\-E\-G\-I\-S\-T\-E\-R. \end{DoxyCompactList}\item 
uint8\-\_\-t $\ast$ \hyperlink{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}{mag\-\_\-read\-\_\-reg} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t reg, uint8\-\_\-t count)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E. \end{DoxyCompactList}\item 
int \hyperlink{communication_2imu__functions_8h_a014f908c9faa37c1ec75177a17012a01}{mag\-\_\-init} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, uint8\-\_\-t rate, uint8\-\_\-t range, uint8\-\_\-t samples\-\_\-avg, uint8\-\_\-t meas\-\_\-mode, uint8\-\_\-t op\-\_\-mode)
\begin{DoxyCompactList}\small\item\em I\-N\-I\-T\-I\-A\-L\-I\-Z\-E M\-A\-G\-N\-E\-T\-O\-M\-E\-T\-E\-R. \end{DoxyCompactList}\item 
int \hyperlink{communication_2imu__functions_8h_ab42ae0d0a2a6f37cf36d856c072b7f34}{mag\-\_\-read\-\_\-all\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, short int $\ast$data)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y and Z) \end{DoxyCompactList}\item 
short int \hyperlink{communication_2imu__functions_8h_a542a31ccd07cd2c3e8e2b68cdb6d219e}{mag\-\_\-read\-\_\-data} (int \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\-\_\-dev}, int axis)
\begin{DoxyCompactList}\small\item\em R\-E\-A\-D D\-A\-T\-A (X, Y or Z) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{communication_2imu__functions_8h_a909f4a5773e20e672cdb4088e1cfa22f}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!A\-D\-D\-\_\-\-A\-D\-X\-L345@{A\-D\-D\-\_\-\-A\-D\-X\-L345}}
\index{A\-D\-D\-\_\-\-A\-D\-X\-L345@{A\-D\-D\-\_\-\-A\-D\-X\-L345}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{A\-D\-D\-\_\-\-A\-D\-X\-L345}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\-D\-D\-\_\-\-A\-D\-X\-L345~0x53}}\label{communication_2imu__functions_8h_a909f4a5773e20e672cdb4088e1cfa22f}


Definition at line 32 of file imu\-\_\-functions.\-h.



Referenced by devices\-\_\-init(), and read\-\_\-all\-\_\-data().

\hypertarget{communication_2imu__functions_8h_a383c09d3e3bbe30097f7eb8d081fb856}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!A\-D\-D\-\_\-\-H\-M\-C5883@{A\-D\-D\-\_\-\-H\-M\-C5883}}
\index{A\-D\-D\-\_\-\-H\-M\-C5883@{A\-D\-D\-\_\-\-H\-M\-C5883}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{A\-D\-D\-\_\-\-H\-M\-C5883}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\-D\-D\-\_\-\-H\-M\-C5883~0x1\-E}}\label{communication_2imu__functions_8h_a383c09d3e3bbe30097f7eb8d081fb856}


Definition at line 34 of file imu\-\_\-functions.\-h.



Referenced by devices\-\_\-init(), and read\-\_\-all\-\_\-data().

\hypertarget{communication_2imu__functions_8h_ab9fd1068a3f5fcba24d92918aaf0dcb5}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!A\-D\-D\-\_\-\-I\-T\-G3200@{A\-D\-D\-\_\-\-I\-T\-G3200}}
\index{A\-D\-D\-\_\-\-I\-T\-G3200@{A\-D\-D\-\_\-\-I\-T\-G3200}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{A\-D\-D\-\_\-\-I\-T\-G3200}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\-D\-D\-\_\-\-I\-T\-G3200~0x68}}\label{communication_2imu__functions_8h_ab9fd1068a3f5fcba24d92918aaf0dcb5}


Definition at line 33 of file imu\-\_\-functions.\-h.



Referenced by devices\-\_\-init(), and read\-\_\-all\-\_\-data().

\hypertarget{communication_2imu__functions_8h_aa3f75ad2972ec8996ce5206feac0e52c}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!A\-S\-C\-I\-I\-\_\-0@{A\-S\-C\-I\-I\-\_\-0}}
\index{A\-S\-C\-I\-I\-\_\-0@{A\-S\-C\-I\-I\-\_\-0}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{A\-S\-C\-I\-I\-\_\-0}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\-S\-C\-I\-I\-\_\-0~0x30}}\label{communication_2imu__functions_8h_aa3f75ad2972ec8996ce5206feac0e52c}


Definition at line 27 of file imu\-\_\-functions.\-h.



Referenced by conv\-\_\-byte\-\_\-hex\-\_\-bin().

\hypertarget{communication_2imu__functions_8h_a6d58f9ac447476b4e084d7ca383f5183}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!F\-A\-I\-L\-U\-R\-E@{F\-A\-I\-L\-U\-R\-E}}
\index{F\-A\-I\-L\-U\-R\-E@{F\-A\-I\-L\-U\-R\-E}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{F\-A\-I\-L\-U\-R\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\-A\-I\-L\-U\-R\-E~-\/1}}\label{communication_2imu__functions_8h_a6d58f9ac447476b4e084d7ca383f5183}


Definition at line 30 of file imu\-\_\-functions.\-h.

\hypertarget{communication_2imu__functions_8h_aa90cac659d18e8ef6294c7ae337f6b58}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!S\-U\-C\-C\-E\-S\-S@{S\-U\-C\-C\-E\-S\-S}}
\index{S\-U\-C\-C\-E\-S\-S@{S\-U\-C\-C\-E\-S\-S}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{S\-U\-C\-C\-E\-S\-S}]{\setlength{\rightskip}{0pt plus 5cm}\#define S\-U\-C\-C\-E\-S\-S~1}}\label{communication_2imu__functions_8h_aa90cac659d18e8ef6294c7ae337f6b58}


Definition at line 29 of file imu\-\_\-functions.\-h.



\subsection{Function Documentation}
\hypertarget{communication_2imu__functions_8h_a1a6b2f719b4fef8f97d6d1b8f495148e}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!conv\-\_\-byte\-\_\-hex\-\_\-bin@{conv\-\_\-byte\-\_\-hex\-\_\-bin}}
\index{conv\-\_\-byte\-\_\-hex\-\_\-bin@{conv\-\_\-byte\-\_\-hex\-\_\-bin}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{conv\-\_\-byte\-\_\-hex\-\_\-bin}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ conv\-\_\-byte\-\_\-hex\-\_\-bin (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t $\ast$}]{hvalue}
\end{DoxyParamCaption}
)}}\label{communication_2imu__functions_8h_a1a6b2f719b4fef8f97d6d1b8f495148e}


Definition at line 184 of file acc\-\_\-functions.\-c.


\begin{DoxyCode}
\{
  \textcolor{keywordtype}{char} \hyperlink{communication_2spi__functions_8c_a46a6da6b1936191571fd30b2a749f38c}{bits}[9];
  \textcolor{keywordtype}{int} i;
  \textcolor{keywordflow}{for}( i=0; i<8; i++)
  \{
    bits[i]=((*hvalue)<<i)>>7+\hyperlink{communication_2imu__functions_8h_aa3f75ad2972ec8996ce5206feac0e52c}{ASCII\_0};
  \}
  bits[8]=\textcolor{charliteral}{'\(\backslash\)0'};
  \textcolor{keywordflow}{return} \hyperlink{communication_2spi__functions_8c_a46a6da6b1936191571fd30b2a749f38c}{bits};
\}
\end{DoxyCode}
\hypertarget{communication_2imu__functions_8h_a014f908c9faa37c1ec75177a17012a01}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!mag\-\_\-init@{mag\-\_\-init}}
\index{mag\-\_\-init@{mag\-\_\-init}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{mag\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int mag\-\_\-init (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{uint8\-\_\-t}]{rate, }
\item[{uint8\-\_\-t}]{range, }
\item[{uint8\-\_\-t}]{samples\-\_\-avg, }
\item[{uint8\-\_\-t}]{meas\-\_\-mode, }
\item[{uint8\-\_\-t}]{op\-\_\-mode}
\end{DoxyParamCaption}
)}}\label{communication_2imu__functions_8h_a014f908c9faa37c1ec75177a17012a01}


I\-N\-I\-T\-I\-A\-L\-I\-Z\-E M\-A\-G\-N\-E\-T\-O\-M\-E\-T\-E\-R. 



Definition at line 53 of file mag\-\_\-functions.\-c.



Referenced by devices\-\_\-init().


\begin{DoxyCode}
\{ 
  uint8\_t data=0;

  \textcolor{keywordflow}{switch}(rate)\{
    \textcolor{keywordflow}{case} 15:
      data=0x10;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 0:
      data=0x00;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 1:
      data=0x04;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 3:
      data=0x08;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 7:
      data=0x0C;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 30:
      data=0x14;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 75:
      data=0x18;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{default}:
      perror(\textcolor{stringliteral}{"Wrong rate value"});
      \textcolor{keywordflow}{break};
  \}
  
  \textcolor{keywordflow}{switch}(samples\_avg)\{
    \textcolor{keywordflow}{case} 8:
      data=data|0x60;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 1:
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 2:
      data=data|0x20;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} 4:
      data=data|0x40;
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{default}:
      perror(\textcolor{stringliteral}{"Wrong samples\_avg value"});
      \textcolor{keywordflow}{break};
  \}
  
  data+=meas\_mode;
  
  \textcolor{keywordflow}{if}(\hyperlink{communication_2imu__functions_8h_ab5d0ae421cd4bb10b1b7a1eda167416b}{mag\_write\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{communication_2imu__regs_8h_a4c80cd6ce866f16a3d999ee2c5635ec9}{MAG\_CONFIG\_A}, data)
      <0)\{
    perror(\textcolor{stringliteral}{"Write in Configuration register A unsuccesful"});
    \textcolor{keywordflow}{return} -1;
  \}
  
  \textcolor{keywordflow}{if}(\hyperlink{communication_2imu__functions_8h_ab5d0ae421cd4bb10b1b7a1eda167416b}{mag\_write\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{communication_2imu__regs_8h_a094173f77219df894d97eed44405d942}{MAG\_CONFIG\_B}, range
      <<5)<0)\{
    perror(\textcolor{stringliteral}{"Write in configuration register B unsuccesful"});
    \textcolor{keywordflow}{return} -1;
  \}
  
  \textcolor{keywordflow}{if}(\hyperlink{communication_2imu__functions_8h_ab5d0ae421cd4bb10b1b7a1eda167416b}{mag\_write\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{communication_2imu__regs_8h_a0173afba6efc0e164495bf506a9758d2}{MAG\_MODE}, op\_mode)<0)\{
    perror(\textcolor{stringliteral}{"Write in mode register unsuccesful"});
    \textcolor{keywordflow}{return} -1;
  \}
  
  \textcolor{keywordflow}{return} 1;
\}
\end{DoxyCode}
\hypertarget{communication_2imu__functions_8h_ab42ae0d0a2a6f37cf36d856c072b7f34}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!mag\-\_\-read\-\_\-all\-\_\-data@{mag\-\_\-read\-\_\-all\-\_\-data}}
\index{mag\-\_\-read\-\_\-all\-\_\-data@{mag\-\_\-read\-\_\-all\-\_\-data}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{mag\-\_\-read\-\_\-all\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}int mag\-\_\-read\-\_\-all\-\_\-data (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{short int $\ast$}]{data}
\end{DoxyParamCaption}
)}}\label{communication_2imu__functions_8h_ab42ae0d0a2a6f37cf36d856c072b7f34}


R\-E\-A\-D A\-L\-L D\-A\-T\-A A\-T O\-N\-C\-E (X, Y and Z) 



Definition at line 121 of file mag\-\_\-functions.\-c.



Referenced by read\-\_\-all\-\_\-data().


\begin{DoxyCode}
\{
  uint8\_t i, j;
  uint8\_t *data8;
  \textcolor{keyword}{union }result
  \{
    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \textcolor{keywordtype}{int} usgnd[3];
    \textcolor{keywordtype}{short} \textcolor{keywordtype}{int} sgnd[3];
  \} result;
  \textcolor{comment}{//result=(union result*)malloc(3*sizeof(union result));}
  \textcolor{keywordflow}{if}( (data8=\hyperlink{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_a4f883328e7ae117996e334145ddd0032}{MAG\_DATAX1},6))==
      NULL)
  \{
    \textcolor{comment}{//perror("Read accelerometer register failed");}
    \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE};
  \}
  \textcolor{comment}{//result.usgnd=(unsigned int*)malloc(3*sizeof(unsigned int));}
  j=0;
  \textcolor{keywordflow}{for}(i=0; i<3; i++)
  \{
    result.usgnd[j]=0;
    result.usgnd[j]=result.usgnd[j]|((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} int)data8[i*2+1])|(((\textcolor{keywordtype}{
      unsigned} int)data8[i*2])<<8);
    data[j]=result.sgnd[j];
    j=2-i; \textcolor{comment}{// trick used to change the sorting of the data from XZY to XYZ}
  \}
  \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};  
\}
\end{DoxyCode}
\hypertarget{communication_2imu__functions_8h_a542a31ccd07cd2c3e8e2b68cdb6d219e}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!mag\-\_\-read\-\_\-data@{mag\-\_\-read\-\_\-data}}
\index{mag\-\_\-read\-\_\-data@{mag\-\_\-read\-\_\-data}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{mag\-\_\-read\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}short int mag\-\_\-read\-\_\-data (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{int}]{axis}
\end{DoxyParamCaption}
)}}\label{communication_2imu__functions_8h_a542a31ccd07cd2c3e8e2b68cdb6d219e}


R\-E\-A\-D D\-A\-T\-A (X, Y or Z) 



Definition at line 148 of file mag\-\_\-functions.\-c.


\begin{DoxyCode}
\{
  uint8\_t *data;
  \textcolor{keyword}{union }result
  \{
    \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} usgnd;
    \textcolor{keywordtype}{int} sgnd;
  \}result;

  \textcolor{keywordflow}{switch}(axis)\{
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'X'}:
      data=\hyperlink{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_a4f883328e7ae117996e334145ddd0032}{MAG\_DATAX1},2);
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'Y'}:
      data=\hyperlink{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_ae218906702b1e40c2b6970f97dd0cfe4}{MAG\_DATAY1},2);
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} \textcolor{charliteral}{'Z'}:
      data=\hyperlink{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}{mag\_read\_reg}(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev},\hyperlink{communication_2imu__regs_8h_a81d7d9236ec69a1a229e4fa7c6299fde}{MAG\_DATAZ1},2);
      \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{default}:
      \textcolor{comment}{//perror("Wrong argument for axis in mag\_read\_data");}
      \textcolor{keywordflow}{return} -1;
  \}
  result.usgnd=0;
  result.usgnd=result.usgnd|(((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} int)data[1]))|(((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} \textcolor{keywordtype}{
      int})data[0])<<8);
  \textcolor{keywordflow}{return} result.sgnd;
\}
\end{DoxyCode}
\hypertarget{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!mag\-\_\-read\-\_\-reg@{mag\-\_\-read\-\_\-reg}}
\index{mag\-\_\-read\-\_\-reg@{mag\-\_\-read\-\_\-reg}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{mag\-\_\-read\-\_\-reg}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t$\ast$ mag\-\_\-read\-\_\-reg (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{uint8\-\_\-t}]{reg, }
\item[{uint8\-\_\-t}]{count}
\end{DoxyParamCaption}
)}}\label{communication_2imu__functions_8h_a6830eaeae2298320e1e8c902e4edd709}


R\-E\-A\-D C\-O\-U\-N\-T 8-\/\-B\-I\-T R\-E\-G\-I\-S\-T\-E\-R I\-N S\-E\-Q\-U\-E\-N\-C\-E. 


\begin{DoxyParams}{Parameters}
{\em count} & number of registers in sequence (1-\/13) \\
\hline
\end{DoxyParams}


Definition at line 31 of file mag\-\_\-functions.\-c.



Referenced by mag\-\_\-read\-\_\-all\-\_\-data(), and mag\-\_\-read\-\_\-data().


\begin{DoxyCode}
\{
  uint8\_t data[13];
  \textcolor{keywordtype}{int} i;

  \textcolor{comment}{//data=(uint8\_t*)malloc((count+1)*sizeof(data));}
  
  data[0] = reg;

  \textcolor{keywordflow}{if} (write(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, &data, 1) != 1) \{            
        \textcolor{comment}{//perror("write before read");}
        \textcolor{keywordflow}{return} NULL;
  \}
  data[0] = 0;
  \textcolor{keywordflow}{if} (read(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, &data, count) != count) \{
        \textcolor{comment}{//perror("read");}
        \textcolor{keywordflow}{return} NULL;    
  \}

  \textcolor{keywordflow}{return} data;
\}
\end{DoxyCode}
\hypertarget{communication_2imu__functions_8h_ab5d0ae421cd4bb10b1b7a1eda167416b}{\index{communication/imu\-\_\-functions.\-h@{communication/imu\-\_\-functions.\-h}!mag\-\_\-write\-\_\-reg@{mag\-\_\-write\-\_\-reg}}
\index{mag\-\_\-write\-\_\-reg@{mag\-\_\-write\-\_\-reg}!communication/imu_functions.h@{communication/imu\-\_\-functions.\-h}}
\subsubsection[{mag\-\_\-write\-\_\-reg}]{\setlength{\rightskip}{0pt plus 5cm}int mag\-\_\-write\-\_\-reg (
\begin{DoxyParamCaption}
\item[{int}]{i2c\-\_\-dev, }
\item[{uint8\-\_\-t}]{reg, }
\item[{uint8\-\_\-t}]{data}
\end{DoxyParamCaption}
)}}\label{communication_2imu__functions_8h_ab5d0ae421cd4bb10b1b7a1eda167416b}


W\-R\-I\-T\-E T\-O R\-E\-G\-I\-S\-T\-E\-R. 

W\-R\-I\-T\-E T\-O R\-E\-G\-I\-S\-T\-E\-R.

Implements the I2\-C communication between Gumstix Overo Fire and H\-M\-C5883 \begin{DoxyAuthor}{Author}
Caio Gustavo Mesquita Ângelo 
\end{DoxyAuthor}


Definition at line 10 of file mag\-\_\-functions.\-c.



Referenced by mag\-\_\-init().


\begin{DoxyCode}
\{
  uint8\_t reg\_data[2];

  reg\_data[0] = reg;
  reg\_data[1] = data;

  \textcolor{keywordflow}{if}( \hyperlink{communication_2imu__regs_8h_a0173afba6efc0e164495bf506a9758d2}{MAG\_MODE}<reg )
  \{
      \textcolor{comment}{//perror("Write unsucessful: Not a valid writable register");}
      \textcolor{keywordflow}{return} -1;
  \}
        
  \textcolor{keywordflow}{if} (write(\hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, &reg\_data, 2) != 2) \{                
          \textcolor{comment}{//perror("Write unsuccessful");}
          \textcolor{keywordflow}{return} -1;
  \}

  \textcolor{keywordflow}{return} 1;
\}
\end{DoxyCode}
