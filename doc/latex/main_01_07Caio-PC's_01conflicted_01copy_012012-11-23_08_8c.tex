\hypertarget{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c}{\section{André backup conflitos/main (Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).c File Reference}
\label{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c}\index{André backup conflitos/main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c@{André backup conflitos/main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c}}
}
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include \char`\"{}Communication/communication.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}main.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_aa570d24f638774bf52f70f1d9d9d45f8}{log\-\_\-init} (F\-I\-L\-E $\ast$log)
\item 
int \hyperlink{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_aa570d24f638774bf52f70f1d9d9d45f8}{\index{main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c@{main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c}!log\-\_\-init@{log\-\_\-init}}
\index{log\-\_\-init@{log\-\_\-init}!main (Caio-PC's conflicted copy 2012-11-23).c@{main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c}}
\subsubsection[{log\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}void log\-\_\-init (
\begin{DoxyParamCaption}
\item[{F\-I\-L\-E $\ast$}]{log}
\end{DoxyParamCaption}
)}}\label{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_aa570d24f638774bf52f70f1d9d9d45f8}


Definition at line 5 of file main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c.


\begin{DoxyCode}
\{
  fprintf(log,\textcolor{stringliteral}{"Iterations\(\backslash\)tADC\(\backslash\)t|\(\backslash\)t\(\backslash\)tACC\(\backslash\)t\(\backslash\)t|\(\backslash\)t\(\backslash\)tMAG\(\backslash\)t\(\backslash\)t|\(\backslash\)t\(\backslash\)tGYR\(\backslash\)t\(\backslash\)tT\(\backslash\)n"}); 
      printf(\textcolor{stringliteral}{"\(\backslash\)nIterations\(\backslash\)tADC\(\backslash\)t|\(\backslash\)t\(\backslash\)tACC\(\backslash\)t\(\backslash\)t|\(\backslash\)t\(\backslash\)tMAG\(\backslash\)t\(\backslash\)t|\(\backslash\)t\(\backslash\)tGYR\(\backslash\)t\(\backslash\)tT\(\backslash\)n"});
  fprintf(log,\textcolor{stringliteral}{"    #\(\backslash\)t|\(\backslash\)t0\(\backslash\)t|\(\backslash\)t X\(\backslash\)tY\(\backslash\)tZ\(\backslash\)t|\(\backslash\)t X\(\backslash\)tY\(\backslash\)tZ\(\backslash\)t|\(\backslash\)t X\(\backslash\)tY\(\backslash\)tZ\(\backslash\)t\(\backslash\)n"}); printf
      (\textcolor{stringliteral}{"    #\(\backslash\)t|\(\backslash\)t0\(\backslash\)t|\(\backslash\)t X\(\backslash\)tY\(\backslash\)tZ\(\backslash\)t|\(\backslash\)t X\(\backslash\)tY\(\backslash\)tZ\(\backslash\)t|\(\backslash\)t X\(\backslash\)tY\(\backslash\)tZ\(\backslash\)t\(\backslash\)n"});
  fprintf(log,\textcolor{stringliteral}{"
      \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\)n"});
  printf(\textcolor{stringliteral}{"
      \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\(\backslash\)n"});
  \textcolor{keywordflow}{return};
\}
\end{DoxyCode}
\hypertarget{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_a840291bc02cba5474a4cb46a9b9566fe}{\index{main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c@{main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c}!main@{main}}
\index{main@{main}!main (Caio-PC's conflicted copy 2012-11-23).c@{main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{main_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_a840291bc02cba5474a4cb46a9b9566fe}


Definition at line 14 of file main (\-Caio-\/\-P\-C's conflicted copy 2012-\/11-\/23).\-c.



References acc\-\_\-init(), acc\-\_\-read\-\_\-all\-\_\-data(), adc\-\_\-read(), A\-D\-D\-\_\-\-A\-D\-X\-L345, A\-D\-D\-\_\-\-H\-M\-C5883, A\-D\-D\-\_\-\-I\-T\-G3200, g\-Data\-Logger, g\-Data\-Logger\-\_\-\-Declare\-Variable(), g\-Data\-Logger\-\_\-\-Init(), g\-Data\-Logger\-\_\-\-Insert\-Variable(), gyr\-\_\-init(), gyr\-\_\-read\-\_\-all\-\_\-data(), i2c\-\_\-dev, log\-\_\-init(), mag\-\_\-init(), mag\-\_\-read\-\_\-all\-\_\-data(), spi\-\_\-dev, and spi\-\_\-init().


\begin{DoxyCode}
\{
  \textcolor{keywordtype}{int} \hyperlink{CommunicationV0_2communication_8c_a7751bd45ac1064efb35adf1f19c25db8}{i2c\_dev}, \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev};
  FILE *log;
  \textcolor{keywordtype}{short} \textcolor{keywordtype}{int} *data;
  \textcolor{keywordtype}{short} \textcolor{keywordtype}{int} datap[4];
  \textcolor{keywordtype}{int} i;
  \textcolor{keywordtype}{double} value[3];

  \textcolor{keywordflow}{if}( (i2c\_dev = open(\textcolor{stringliteral}{"/dev/i2c-3"}, O\_RDWR))<0 )
  \{
    perror(\textcolor{stringliteral}{"Failed to open i2c\_dev"});
    \textcolor{keywordflow}{return} -1;
  \}

\textcolor{comment}{// INITIALIZATION OF SENSORS AND DEVICES}
  \textcolor{keywordflow}{if} ((ioctl(i2c\_dev, I2C\_SLAVE, \hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_a383c09d3e3bbe30097f7eb8d081fb856}{ADD\_HMC5883})) < 0) \{
                perror(\textcolor{stringliteral}{"ioctl(I2C\_SLAVE) mag"});
                \textcolor{keywordflow}{return} -1;
  \}
  \textcolor{keywordflow}{if}( (\hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_a014f908c9faa37c1ec75177a17012a01}{mag\_init}(i2c\_dev, 75, 0, 8, 0, 0))< 0)
  \{
      perror(\textcolor{stringliteral}{"Error in magnetometer initialization"});
      \textcolor{keywordflow}{return} -1;
  \}
  \textcolor{keywordflow}{if}( ioctl(i2c\_dev, I2C\_SLAVE, \hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_ab9fd1068a3f5fcba24d92918aaf0dcb5}{ADD\_ITG3200}) < 0) \{
                perror(\textcolor{stringliteral}{"ioctl(I2C\_SLAVE) gyr"});
                \textcolor{keywordflow}{return} -1;
  \} 
  \textcolor{keywordflow}{if}( \hyperlink{group__gyr_ga6d02be352b4491a236c9695a6a24d174}{gyr\_init}(i2c\_dev, 100, 188, \textcolor{charliteral}{'Z'}, \textcolor{stringliteral}{"XYZ"})<0 )
  \{
      perror(\textcolor{stringliteral}{"Error in gyrometer initialization"});
      \textcolor{keywordflow}{return} -1;
  \}
  \textcolor{keywordflow}{if} ( (ioctl(i2c\_dev, I2C\_SLAVE, \hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_a909f4a5773e20e672cdb4088e1cfa22f}{ADD\_ADXL345})) < 0) \{
        perror(\textcolor{stringliteral}{"ioctl(I2C\_SLAVE) acc"});
        \textcolor{keywordflow}{return} -1;
  \}  
  \textcolor{keywordflow}{if}( \hyperlink{group__acc_gae8f9cc6e0d15e61039d846305f86f073}{acc\_init}(i2c\_dev, 1, 100, 16)<0)
  \{
        perror(\textcolor{stringliteral}{"Error in accelerometer initialization"});
        \textcolor{keywordflow}{return} -1;
  \}

  \textcolor{keywordflow}{if} ((spi\_dev=\hyperlink{spi__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8c_a70764aca888e93b0329e7a62c9312704}{spi\_init}(0,46875,0))<0) 
  \{
    perror(\textcolor{stringliteral}{"Error in SPI device initialization"});
    \textcolor{keywordflow}{return} -1;
  \}
  
  \textcolor{keywordflow}{if}( (log=fopen(\textcolor{stringliteral}{"log.txt"},\textcolor{stringliteral}{"w"}))==NULL )
  \{
    perror(\textcolor{stringliteral}{"Unsuccessful log file openning"});
    \textcolor{keywordflow}{return} -1;
  \}
  \hyperlink{main_01_07Caio_01Gustavo_01Mesquita_01Angelo's_01conflicted_01copy_012012-11-23_08_8c_aa570d24f638774bf52f70f1d9d9d45f8}{log\_init}(log);
  
\textcolor{comment}{// Initializing gdatalogger}
  \textcolor{keywordflow}{if}(!\hyperlink{gdatalogger_8c_ab5eeb22d60836d57bae0dde821337045}{gDataLogger\_Init}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger},\textcolor{stringliteral}{"
      matlabdatafiles/gmatlabdatafile.mat"},NULL))\{
                printf(\textcolor{stringliteral}{"\(\backslash\)nErro em gDataLogger\_Init\(\backslash\)n\(\backslash\)n"});
                \textcolor{keywordflow}{return} EXIT\_FAILURE;
        \}

        \hyperlink{gdatalogger_8c_a3f8f2b3c3f5edc72c3a1887965a544c1}{gDataLogger\_DeclareVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"acc"},\textcolor{stringliteral}{"m/s²"},1,3,1000);
        \hyperlink{gdatalogger_8c_a3f8f2b3c3f5edc72c3a1887965a544c1}{gDataLogger\_DeclareVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"gyr"},\textcolor{stringliteral}{"\(\backslash\)][\{º/s"},1,3,1000);
        \hyperlink{gdatalogger_8c_a3f8f2b3c3f5edc72c3a1887965a544c1}{gDataLogger\_DeclareVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"mag"},\textcolor{stringliteral}{"mG"},1,3,1000);
        \hyperlink{gdatalogger_8c_a3f8f2b3c3f5edc72c3a1887965a544c1}{gDataLogger\_DeclareVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"temp"},\textcolor{stringliteral}{"K"},1,1,1000);
        \hyperlink{gdatalogger_8c_a3f8f2b3c3f5edc72c3a1887965a544c1}{gDataLogger\_DeclareVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"Vin"},\textcolor{stringliteral}{"V"},1,1,1000);
  
\textcolor{comment}{// ROUTINE }
  \textcolor{keywordflow}{for}( i=1; i<=20; i++)
  \{  
      fprintf(log,\textcolor{stringliteral}{"    %d\(\backslash\)t|"},i); printf(\textcolor{stringliteral}{"    %d\(\backslash\)t|"},i);
  \textcolor{comment}{// ADC}
\textcolor{comment}{/*FALTA IMPLEMENTAR AS ESCRITAS NOS GPIOS RESPONSÁVEIS PELA SELEÇÃO DO CHIP
       SELECT QUANDO REALMENTE FOR USAR A PLACA*/}
      \textcolor{comment}{//spi\_dev=spi\_init(0,46875,0);}
      datap[0]=\hyperlink{spi__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8c_ae385345c227d9f67ab490b94ed628988}{adc\_read}(spi\_dev,0,1);
      fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t%d\(\backslash\)t|"},datap[0]);printf(\textcolor{stringliteral}{"\(\backslash\)t%d\(\backslash\)t|"},datap[0]);
      value[0]=(double)datap[0]/1000;
      \hyperlink{gdatalogger_8c_a32674e7c2afa8b78e99a0070cf4bcaf9}{gDataLogger\_InsertVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"Vin"},&(value[0]));
  \textcolor{comment}{// ACCelerometer}
      \textcolor{keywordflow}{if} ( (ioctl(i2c\_dev, I2C\_SLAVE, \hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_a909f4a5773e20e672cdb4088e1cfa22f}{ADD\_ADXL345})) < 0) \{
        perror(\textcolor{stringliteral}{"ioctl(I2C\_SLAVE) acc"});
        \textcolor{keywordflow}{return} -1;
      \}  
      \textcolor{keywordflow}{if}( (\hyperlink{group__acc_ga013bb5ed8a763883fc440549d2b1a6ce}{acc\_read\_all\_data}(i2c\_dev,datap))>0 )\{
        fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t|"},datap[0],datap[1],datap[2]); printf(\textcolor{stringliteral}{"\(\backslash\)t%d
      \(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t|"},datap[0],datap[1],datap[2]);
        
      \}
      \textcolor{keywordflow}{else}\{
        fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?\(\backslash\)t|"}); printf(\textcolor{stringliteral}{"\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?\(\backslash\)t|"});\}
      value[0]=(double)datap[0]*0.0392;
      value[1]=(double)datap[1]*0.0392;
      value[2]=(double)datap[2]*0.0392;
      \hyperlink{gdatalogger_8c_a32674e7c2afa8b78e99a0070cf4bcaf9}{gDataLogger\_InsertVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"acc"},value);
  \textcolor{comment}{// MAGometer    }
      \textcolor{keywordflow}{if}( (ioctl(i2c\_dev, I2C\_SLAVE, \hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_a383c09d3e3bbe30097f7eb8d081fb856}{ADD\_HMC5883})) < 0) \{
        perror(\textcolor{stringliteral}{"ioctl(I2C\_SLAVE) mag"});
        \textcolor{keywordflow}{return} -1;
      \} 
      \textcolor{keywordflow}{if}( (\hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_a8f2fd896caf1216ba82e535e6251692f}{mag\_read\_all\_data}(i2c\_dev,datap))>0 )\{
        fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t|"},datap[0],datap[1],datap[2]); printf(\textcolor{stringliteral}{"\(\backslash\)t%d
      \(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t|"},datap[0],datap[1],datap[2]);\}
      \textcolor{keywordflow}{else}\{
        fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?\(\backslash\)t|"}); printf(\textcolor{stringliteral}{"\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?\(\backslash\)t|"});\}
      value[0]=(double)datap[0]*0.73;
      value[1]=(double)datap[1]*0.73;
      value[2]=(double)datap[2]*0.73;
      \hyperlink{gdatalogger_8c_a32674e7c2afa8b78e99a0070cf4bcaf9}{gDataLogger\_InsertVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"mag"},value);
  \textcolor{comment}{// GYRometer    }
      \textcolor{keywordflow}{if}( (ioctl(i2c\_dev, I2C\_SLAVE, \hyperlink{imu__functions_01_07C_xC3_xB3pia_01em_01conflito_01de_01Andr_xC3_xA9_01Carvalho_012013-04-26_08_8h_ab9fd1068a3f5fcba24d92918aaf0dcb5}{ADD\_ITG3200})) < 0) \{
        perror(\textcolor{stringliteral}{"ioctl(I2C\_SLAVE) gyr"});
        \textcolor{keywordflow}{return} -1;
      \} 
      \textcolor{keywordflow}{if}( (\hyperlink{group__gyr_ga79875465c3a29fd9ec77308c80a8bc37}{gyr\_read\_all\_data}(i2c\_dev,datap))>0 )\{
        fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t%d"},datap[0],datap[1],datap[2],datap[3]); 
      printf(\textcolor{stringliteral}{"\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t%d\(\backslash\)t%d"},datap[0],datap[1],datap[2],datap[3]);\}
      \textcolor{keywordflow}{else}\{
        fprintf(log,\textcolor{stringliteral}{"\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?"}); printf(\textcolor{stringliteral}{"\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?\(\backslash\)t?"});\}
      value[0]=(double)datap[0]*0.0392;
      value[1]=(double)datap[1]*0.0392;
      value[2]=(double)datap[2]*0.0392;
      \hyperlink{gdatalogger_8c_a32674e7c2afa8b78e99a0070cf4bcaf9}{gDataLogger\_InsertVariable}(&\hyperlink{datalogger_01_07Caio-PC's_01conflicted_01copy_012012-11-23_08_8c_abe3b9c2c4e21e79c7b046b5986d13acc}{gDataLogger}
      ,\textcolor{stringliteral}{"acc"},value);
  \textcolor{comment}{//---------------------}
  \textcolor{comment}{// Updating matlab file}
  
  \textcolor{comment}{//---------------------}
      fprintf(log,\textcolor{stringliteral}{"\(\backslash\)n"});printf(\textcolor{stringliteral}{"\(\backslash\)n"});
  \}
  
\textcolor{comment}{// CLOSING FILES}
  fclose(log);
  close(i2c\_dev);
  close(spi\_dev);
\textcolor{keywordflow}{return} 1;
\}
\end{DoxyCode}
