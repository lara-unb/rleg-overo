\hypertarget{main2_8h}{
\section{main2.h File Reference}
\label{main2_8h}\index{main2.h@{main2.h}}
}
This graph shows which files directly or indirectly include this file:\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{main2_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS}~1
\item 
\#define \hyperlink{main2_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE}~-\/1
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{main2_8h_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\item 
int \hyperlink{main2_8h_a26855b7739897854265d51aa61329390}{periodic\_\-task\_\-1} (void)
\item 
int \hyperlink{main2_8h_a944f7352f18ed248c1b1143f51edc391}{periodic\_\-task\_\-2} (void)
\item 
void \hyperlink{main2_8h_a0e411070b7f487a8ab6a60b180f50e12}{timer\_\-start\_\-task\_\-1} (void)
\item 
void \hyperlink{main2_8h_ae59c93969d017f18e3e38b2f9f7888ca}{timer\_\-start\_\-task\_\-2} (void)
\item 
void \hyperlink{main2_8h_a54bb5066619e443a28ae5601b5ea3642}{timer\_\-stop\_\-task\_\-1} (void)
\item 
void \hyperlink{main2_8h_a0c69dbcb7b2885a2de116b9d690280de}{timer\_\-stop\_\-task\_\-2} (void)
\item 
void \hyperlink{main2_8h_a90885bae1b9535b16e014fb928e98e37}{timer\_\-function\_\-task\_\-1} (void)
\item 
void \hyperlink{main2_8h_a01c18e97a4488be2912eb738b2e7f890}{timer\_\-function\_\-task\_\-2} (void)
\item 
int \hyperlink{main2_8h_a97a188c3a74115770124cf0bf0c1e407}{reset\_\-timer} (void)
\item 
int \hyperlink{main2_8h_a5b2b1fdd5e517470c10e84a2b2bcc5c8}{get\_\-time} (double $\ast$time\_\-control\_\-task\_\-s, double $\ast$Ts\_\-control\_\-task\_\-s, double $\ast$mean\_\-time\_\-control\_\-task\_\-s, double $\ast$t0\_\-control\_\-task\_\-s)
\item 
void \hyperlink{main2_8h_a5f05ce725141ddfab683e059b1cd95ea}{exit\_\-program} (void)
\begin{DoxyCompactList}\small\item\em Internal function to end program. \item\end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Define Documentation}
\hypertarget{main2_8h_a6d58f9ac447476b4e084d7ca383f5183}{
\index{main2.h@{main2.h}!FAILURE@{FAILURE}}
\index{FAILURE@{FAILURE}!main2.h@{main2.h}}
\subsubsection[{FAILURE}]{\setlength{\rightskip}{0pt plus 5cm}\#define FAILURE~-\/1}}
\label{main2_8h_a6d58f9ac447476b4e084d7ca383f5183}


Definition at line 6 of file main2.h.

\hypertarget{main2_8h_aa90cac659d18e8ef6294c7ae337f6b58}{
\index{main2.h@{main2.h}!SUCCESS@{SUCCESS}}
\index{SUCCESS@{SUCCESS}!main2.h@{main2.h}}
\subsubsection[{SUCCESS}]{\setlength{\rightskip}{0pt plus 5cm}\#define SUCCESS~1}}
\label{main2_8h_aa90cac659d18e8ef6294c7ae337f6b58}


Definition at line 5 of file main2.h.



\subsection{Function Documentation}
\hypertarget{main2_8h_a5f05ce725141ddfab683e059b1cd95ea}{
\index{main2.h@{main2.h}!exit\_\-program@{exit\_\-program}}
\index{exit\_\-program@{exit\_\-program}!main2.h@{main2.h}}
\subsubsection[{exit\_\-program}]{\setlength{\rightskip}{0pt plus 5cm}void exit\_\-program (void)}}
\label{main2_8h_a5f05ce725141ddfab683e059b1cd95ea}


Internal function to end program. 



Definition at line 135 of file main.c.




\begin{DoxyCode}
135                        {
136   quittask = 1;
137   return;
138 }
\end{DoxyCode}


\hypertarget{main2_8h_a5b2b1fdd5e517470c10e84a2b2bcc5c8}{
\index{main2.h@{main2.h}!get\_\-time@{get\_\-time}}
\index{get\_\-time@{get\_\-time}!main2.h@{main2.h}}
\subsubsection[{get\_\-time}]{\setlength{\rightskip}{0pt plus 5cm}int get\_\-time (double $\ast$ {\em time\_\-control\_\-task\_\-s}, \/  double $\ast$ {\em Ts\_\-control\_\-task\_\-s}, \/  double $\ast$ {\em mean\_\-time\_\-control\_\-task\_\-s}, \/  double $\ast$ {\em t0\_\-control\_\-task\_\-s})}}
\label{main2_8h_a5b2b1fdd5e517470c10e84a2b2bcc5c8}


Definition at line 122 of file main.c.



References TASK\_\-S::period\_\-us, SUCCESS, t0, TASK\_\-S::t\_\-global, TASK\_\-S::T\_\-mean\_\-global, t\_\-task\_\-1\_\-global, T\_\-task\_\-1\_\-mean\_\-global, and task\_\-1\_\-period\_\-us.



Referenced by ui\_\-overview\_\-data().




\begin{DoxyCode}
123 {
124   *time_control_task_s = task1.t_global;
125   *Ts_control_task_s = (task1.period_us)/1e6;
126   *mean_time_control_task_s = task1.T_mean_global;
127   *t0_control_task_s = t0;
128 
129   return SUCCESS;
130 }
\end{DoxyCode}




Here is the caller graph for this function:

\hypertarget{main2_8h_a840291bc02cba5474a4cb46a9b9566fe}{
\index{main2.h@{main2.h}!main@{main}}
\index{main@{main}!main2.h@{main2.h}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (void)}}
\label{main2_8h_a840291bc02cba5474a4cb46a9b9566fe}


Definition at line 12 of file dummie.c.



References IMU\_\-PARAM\_\-STRUCT::acc, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::act, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::clk\_\-source, control\_\-task(), SPI\_\-PARAM\_\-STRUCT::cs, datalogger\_\-close(), datalogger\_\-init(), DATALOGGER\_\-RUNNING, datalogger\_\-status(), datalogger\_\-stop(), DATALOGGER\_\-SUCCESS, datalogger\_\-write\_\-file(), devices\_\-init(), FAILURE, IMU\_\-PARAM\_\-STRUCT::param\_\-acc::full\_\-res, IMU\_\-PARAM\_\-STRUCT::gyr, IMU\_\-PARAM\_\-STRUCT::i2c\_\-dev, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::lpf\_\-bw, IMU\_\-PARAM\_\-STRUCT::mag, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::meas\_\-mode, SPI\_\-PARAM\_\-STRUCT::mode, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::op\_\-mode, ping(), pong(), quittask, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::range, IMU\_\-PARAM\_\-STRUCT::param\_\-acc::range, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::rate, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::rate, IMU\_\-PARAM\_\-STRUCT::param\_\-acc::rate, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::samples\_\-avg, SPI\_\-PARAM\_\-STRUCT::speed, SPI\_\-PARAM\_\-STRUCT::spi\_\-dev, status, SUCCESS, task1, TASK1\_\-PERIOD\_\-US, task2, TASK2\_\-PERIOD\_\-US, task\_\-1\_\-period\_\-us, TASK\_\-UI\_\-PERIOD, timer\_\-new\_\-task(), timer\_\-start\_\-task(), timer\_\-start\_\-task\_\-1(), timer\_\-start\_\-task\_\-2(), timer\_\-stop\_\-task(), timer\_\-stop\_\-task\_\-1(), timer\_\-stop\_\-task\_\-2(), ui\_\-close(), ui\_\-init(), and ui\_\-task().




\begin{DoxyCode}
12           {
13   TASK_S task1,task2;
14   int i=0;
15 
16   timer_new_task(&task1,ping);
17   timer_new_task(&task2,pong);
18 
19   timer_start_task(&task1,1000);
20   timer_start_task(&task2,2000);
21 
22   while(1) i=1;
23   //for(i=1;i<10;i++) printf(" .");
24   
25   timer_stop_task(&task1);
26   timer_stop_task(&task2);
27 
28   exit(0);
29 }
\end{DoxyCode}




Here is the call graph for this function:

\hypertarget{main2_8h_a26855b7739897854265d51aa61329390}{
\index{main2.h@{main2.h}!periodic\_\-task\_\-1@{periodic\_\-task\_\-1}}
\index{periodic\_\-task\_\-1@{periodic\_\-task\_\-1}!main2.h@{main2.h}}
\subsubsection[{periodic\_\-task\_\-1}]{\setlength{\rightskip}{0pt plus 5cm}int periodic\_\-task\_\-1 (void)}}
\label{main2_8h_a26855b7739897854265d51aa61329390}


Definition at line 211 of file main2.c.



References actuate(), DATALOGGER\_\-NOT\_\-RUNNING, DATALOGGER\_\-RUNNING, datalogger\_\-set\_\-Ts(), datalogger\_\-status(), datalogger\_\-update(), failure, IMU\_\-PARAM\_\-STRUCT::i2c\_\-dev, read\_\-all\_\-data(), reset\_\-timer(), SPI\_\-PARAM\_\-STRUCT::spi\_\-dev, SUCCESS, t0, T\_\-task\_\-1\_\-exec\_\-global, t\_\-task\_\-1\_\-global, T\_\-task\_\-2\_\-exec\_\-global, task\_\-1\_\-period\_\-us, total, and MRA\_\-DATA\_\-STRUCT::v\_\-ctl.



Referenced by timer\_\-function\_\-task\_\-1().




\begin{DoxyCode}
212 {
213     //static int previous_calibration_status = CALIBRATION_NOT_RUNNING;
214     //int current_calibration_status; // Used to detect lowering edge
215     static int previous_datalogger_status = DATALOGGER_NOT_RUNNING;
216     int current_datalogger_status; // Used to detect rising edge
217     char user =0;
218    /* int buff_i=0; //i of buffer
219     int i, j, k, equal=0;
220     short int buff[3][3][3]; //{acc,gyr,mag}{x,y,z}{i=1,2,3}
221 */
222 
223     // Main communication/control thread
224 
225     //Acquire
226     total++;
227     if( read_all_data(imu_param.i2c_dev, spi_param.spi_dev, &imu_data, &eff_data,
       &mra_data, &enc_data) != SUCCESS)
228       failure++;
229         /*buff_i=buff_i%5;
230         buff[0][0][buff_i]=imu_data.acc.x;
231         buff[0][1][buff_i]=imu_data.acc.y;
232         buff[0][2][buff_i]=imu_data.acc.z;
233         buff[1][0][buff_i]=imu_data.gyr.x;
234         buff[1][0][buff_i]=imu_data.gyr.x;
235         buff[1][1][buff_i]=imu_data.gyr.y;
236         buff[1][2][buff_i]=imu_data.gyr.z;
237         buff[2][0][buff_i]=imu_data.mag.x;
238         buff[2][1][buff_i]=imu_data.mag.y;
239         buff[2][2][buff_i]=imu_data.mag.z;
240         buff_i++;
241         
242         for( i=0; i<3; i++)
243         {
244           
245           for( j=0; j<3; j++)
246             for( k=1; k<3; k++)
247             {
248               if( buff[i][j][k]==buff[i][j][0] )
249                 equal=1;
250               else
251                 equal=0;
252             }
253           if( equal==1)
254             i=3;
255         }
256         if( equal==1 )
257         {
258           devices_init(&imu_param, &spi_param, &mra_data);
259           equal=0;
260         }*/
261 /*    if(read_all_data(imu_param.i2c_dev, spi_param.spi_dev, &imu_data, &eff_data
      ) != SUCCESS)
262     {
263         failure++;
264     }
265 */
266     // Calibrate and Estimate
267     //calibrate_all(&imu_data);
268     //calibration_calibrate_all(&pwm_read_data, &scp1000_data, &battery_data, &gp
      s_data, &imu_data, &pitot_data, &sonar_data, &calibration_local_coordinate_system
      _data, &calibration_altimeter_data, &calibration_local_fields_data, &gps_measure,
       &imu_measure, &magnetometer_measure);
269     //estimation_update_state_estimate(&estimation_data, &gps_measure, &imu_measu
      re, &magnetometer_measure, &sonar_measure, &calibration_local_fields_data, task_1
      _period_us/(double)1e6);
270 
271     // Control
272     mra_data.v_ctl=1275+(uint8_t)(800*cosf(t_task_1_global*1000));
273     //control_main_task(t_task_1_global, &pwm_write_data, &pwm_read_data, &contro
      l_data, &estimation_data);
274 
275     // Actuate
276     actuate(spi_param.spi_dev, &mra_data);
277     //protocol_send_actuation_data(&pwm_write_data);
278 
279     // Log
280     /*user=getch();
281     switch(user){
282       case 'e': 
283         exit_program();
284         break;
285       case 'a':
286         acquire=1;
287         break;
288       case 's':
289         acquire=0;
290         break;
291       default:
292         break;
293     }*/
294     current_datalogger_status = datalogger_status();
295     if( (current_datalogger_status == DATALOGGER_RUNNING))
296     {
297         if(previous_datalogger_status == DATALOGGER_NOT_RUNNING) // Rising edge
298         {
299             datalogger_set_Ts(task_1_period_us/1e6);
300             reset_timer();
301         }
302         datalogger_update(t_task_1_global, T_task_1_exec_global, 
      T_task_2_exec_global, t0, &imu_data, &eff_data, &mra_data /*&imu_measure, &magnet
      ometer_measure, &estimation_data, &control_data*/);
303   //printf("\n    %d\t|",i);
304  /* printw("%d\t|",eff_data.F.x);
305     printw("\t%d\t%d\t%d\t|",imu_data.acc.x,imu_data.acc.y,imu_data.acc.z);
306     printw("\t%d\t%d\t%d\t|",imu_data.mag.x,imu_data.mag.y,imu_data.mag.z);
307     printw("\t%d\t%d\t%d\t%d",imu_data.gyr.x,imu_data.gyr.y,imu_data.gyr.z, imu_d
      ata.temp);
308     printw("\t%d\t%d",eff_data.new_data,imu_data.new_data);
309     printw("\t%d\t%d",mra_data.Out_0, mra_data.Read_0);
310     printw("\n");
311     refresh();*/
312     }
313     previous_datalogger_status = current_datalogger_status;
314 
315 /*    current_calibration_status = calibration_get_status();
316     if(current_calibration_status == CALIBRATION_RUNNING)
317     {
318         calibration_imu_add_sample_bias_estimate(&imu_data);
319         calibration_altimeter_add_sample_initial_pressure(&scp1000_data, &calibra
      tion_altimeter_data);
320     }
321     else // Calibration not running
322     {
323         if(previous_calibration_status == CALIBRATION_RUNNING) // Lowering edge
324         {
325             calibration_imu_finish_bias_estimate(&imu_data);
326             calibration_altimeter_finish_initial_pressure_estimate(&calibration_a
      ltimeter_data);
327         }
328     }
329     previous_calibration_status = current_calibration_status;
330 */
331     return SUCCESS;
332 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main2_8h_a944f7352f18ed248c1b1143f51edc391}{
\index{main2.h@{main2.h}!periodic\_\-task\_\-2@{periodic\_\-task\_\-2}}
\index{periodic\_\-task\_\-2@{periodic\_\-task\_\-2}!main2.h@{main2.h}}
\subsubsection[{periodic\_\-task\_\-2}]{\setlength{\rightskip}{0pt plus 5cm}int periodic\_\-task\_\-2 (void)}}
\label{main2_8h_a944f7352f18ed248c1b1143f51edc391}


Definition at line 334 of file main2.c.



References IMU\_\-DATA\_\-STRUCT::acc, buff, buff\_\-i, devices\_\-init(), failure, IMU\_\-DATA\_\-STRUCT::gyr, IMU\_\-PARAM\_\-STRUCT::i2c\_\-dev, IMU\_\-DATA\_\-STRUCT::mag, SPI\_\-PARAM\_\-STRUCT::spi\_\-dev, SUCCESS, telemetry\_\-mode, total, UI\_\-NCURSES\_\-MODE, ui\_\-update(), DATA\_\-XYZ::x, DATA\_\-XYZ::y, and DATA\_\-XYZ::z.



Referenced by timer\_\-function\_\-task\_\-2().




\begin{DoxyCode}
335 {
336 
337     int i, j, k, equal=0;
338 
339     // UI thread
340     if(telemetry_mode == UI_NCURSES_MODE)
341     {
342         ui_update(&imu_data, &eff_data, &mra_data,&enc_data, total, failure);
343     }
344                 
345             buff_i=buff_i%5;
346         buff[0][0][buff_i]=imu_data.acc.x;
347         buff[0][1][buff_i]=imu_data.acc.y;
348         buff[0][2][buff_i]=imu_data.acc.z;
349         buff[1][0][buff_i]=imu_data.gyr.x;
350         buff[1][0][buff_i]=imu_data.gyr.x;
351         buff[1][1][buff_i]=imu_data.gyr.y;
352         buff[1][2][buff_i]=imu_data.gyr.z;
353         buff[2][0][buff_i]=imu_data.mag.x;
354         buff[2][1][buff_i]=imu_data.mag.y;
355         buff[2][2][buff_i]=imu_data.mag.z;
356         buff_i++;
357         
358         for( i=0; i<3; i++)
359         {
360           
361           for( j=0; j<3; j++)
362             for( k=1; k<3; k++)
363             {
364               if( buff[i][j][k]==buff[i][j][0] )
365                 equal=1;
366               else
367                 equal=0;
368             }
369           if( equal==1)
370             i=3;
371         }
372         if( equal==1 )
373         {
374           close(imu_param.i2c_dev);
375           close(spi_param.spi_dev);
376           devices_init(&imu_param, &spi_param, &mra_data);
377           equal=0;
378         }
379     /*if(telemetry_mode == UI_MAVLINK_MODE)
380     {
381         mavlink_module_update(t_task_1_global, t0, &battery_data, &gps_data, &imu
      _data, &pitot_data, &pwm_read_data, &pwm_write_data, &scp1000_data, &sonar_data, 
      &gps_measure, &imu_measure, &magnetometer_measure, &estimation_data, &control_dat
      a);
382     }*/
383 
384     return SUCCESS;
385 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main2_8h_a97a188c3a74115770124cf0bf0c1e407}{
\index{main2.h@{main2.h}!reset\_\-timer@{reset\_\-timer}}
\index{reset\_\-timer@{reset\_\-timer}!main2.h@{main2.h}}
\subsubsection[{reset\_\-timer}]{\setlength{\rightskip}{0pt plus 5cm}int reset\_\-timer (void)}}
\label{main2_8h_a97a188c3a74115770124cf0bf0c1e407}


Definition at line 596 of file main2.c.



References SUCCESS, t0, and t\_\-task\_\-1\_\-global.



Referenced by periodic\_\-task\_\-1().




\begin{DoxyCode}
597 {
598     t0 = t_task_1_global;
599     return SUCCESS;
600 }
\end{DoxyCode}




Here is the caller graph for this function:

\hypertarget{main2_8h_a90885bae1b9535b16e014fb928e98e37}{
\index{main2.h@{main2.h}!timer\_\-function\_\-task\_\-1@{timer\_\-function\_\-task\_\-1}}
\index{timer\_\-function\_\-task\_\-1@{timer\_\-function\_\-task\_\-1}!main2.h@{main2.h}}
\subsubsection[{timer\_\-function\_\-task\_\-1}]{\setlength{\rightskip}{0pt plus 5cm}void timer\_\-function\_\-task\_\-1 (void)}}
\label{main2_8h_a90885bae1b9535b16e014fb928e98e37}


Definition at line 483 of file main2.c.



References flag\_\-task\_\-1\_\-firstexecution, periodic\_\-task\_\-1(), status, t0, T\_\-task\_\-1\_\-exec\_\-global, t\_\-task\_\-1\_\-global, T\_\-task\_\-1\_\-max\_\-global, T\_\-task\_\-1\_\-mean\_\-global, and T\_\-task\_\-1\_\-min\_\-global.



Referenced by f\_\-timer\_\-task\_\-1().




\begin{DoxyCode}
484 {
485     int status = 0;
486     static struct timeval timereset;
487     static struct timeval time;
488     static struct timeval time_exec_start;
489     static struct timeval time_exec_end;
490     static double T_task,t_task,t_task_previous;
491     static double T_task_mean,T_task_min,T_task_max,T_task_exec;
492 
493     gettimeofday(&time_exec_start, NULL);
494 
495     // Time calculation
496     if(flag_task_1_firstexecution)
497     {
498         gettimeofday(&timereset, NULL);
499         t_task = 0.0;
500         T_task_mean = 0.0;
501         T_task_min = 0.0;
502         T_task_max = 0.0;
503         T_task_exec = 0.0;
504     }
505 
506     gettimeofday(&time, NULL);
507     t_task = ((time.tv_sec - timereset.tv_sec) + (time.tv_usec - timereset.tv_use
      c)*1e-6);
508     T_task = t_task - t_task_previous;
509     t_task_previous = t_task;
510 
511     if(flag_task_1_firstexecution)
512     {
513         T_task_mean = T_task;
514         T_task_min  = 1e200;
515         T_task_max  = 0.0;
516         t0 = t_task;
517     }
518     else
519     {
520         T_task_mean = 0.05*T_task + 0.95*T_task_mean;
521         if(T_task < T_task_min) T_task_min  = T_task;
522         if(T_task > T_task_max) T_task_max  = T_task;
523     }
524 
525     // Run the thread
526     status = periodic_task_1();
527 
528     gettimeofday(&time_exec_end, NULL);
529     T_task_exec = ((time_exec_end.tv_sec - time_exec_start.tv_sec) + (time_exec_e
      nd.tv_usec - time_exec_start.tv_usec)*1e-6);
530 
531     t_task_1_global = t_task;
532     T_task_1_mean_global = T_task_mean;
533     T_task_1_min_global = T_task_min;
534     T_task_1_max_global = T_task_max;
535     T_task_1_exec_global = T_task_exec;
536 
537     flag_task_1_firstexecution = 0;
538 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main2_8h_a01c18e97a4488be2912eb738b2e7f890}{
\index{main2.h@{main2.h}!timer\_\-function\_\-task\_\-2@{timer\_\-function\_\-task\_\-2}}
\index{timer\_\-function\_\-task\_\-2@{timer\_\-function\_\-task\_\-2}!main2.h@{main2.h}}
\subsubsection[{timer\_\-function\_\-task\_\-2}]{\setlength{\rightskip}{0pt plus 5cm}void timer\_\-function\_\-task\_\-2 (void)}}
\label{main2_8h_a01c18e97a4488be2912eb738b2e7f890}


Definition at line 540 of file main2.c.



References flag\_\-task\_\-2\_\-firstexecution, periodic\_\-task\_\-2(), status, T\_\-task\_\-2\_\-exec\_\-global, t\_\-task\_\-2\_\-global, T\_\-task\_\-2\_\-max\_\-global, T\_\-task\_\-2\_\-mean\_\-global, and T\_\-task\_\-2\_\-min\_\-global.



Referenced by f\_\-timer\_\-task\_\-2().




\begin{DoxyCode}
541 {
542     int status = 0;
543     static struct timeval timereset;
544     static struct timeval time;
545     static struct timeval time_exec_start;
546     static struct timeval time_exec_end;
547     static double T_task,t_task,t_task_previous;
548     static double T_task_mean,T_task_min,T_task_max,T_task_exec;
549 
550     gettimeofday(&time_exec_start, NULL);
551 
552     // Time calculation
553     if(flag_task_2_firstexecution)
554     {
555         gettimeofday(&timereset, NULL);
556         t_task = 0.0;
557         T_task_mean = 0.0;
558         T_task_min = 0.0;
559         T_task_max = 0.0;
560         T_task_exec = 0.0;
561     }
562 
563     gettimeofday(&time, NULL);
564     t_task = ((time.tv_sec - timereset.tv_sec) + (time.tv_usec - timereset.tv_use
      c)*1e-6);
565     T_task = t_task - t_task_previous;
566     t_task_previous = t_task;
567 
568     if(flag_task_2_firstexecution)
569     {
570         T_task_mean = T_task;
571         T_task_min  = 1e200;
572         T_task_max  = 0.0;
573     }
574     else
575     {
576         T_task_mean = 0.05*T_task + 0.95*T_task_mean;
577         if(T_task < T_task_min) T_task_min  = T_task;
578         if(T_task > T_task_max) T_task_max  = T_task;
579     }
580 
581     // Run the thread
582     status = periodic_task_2();
583 
584     gettimeofday(&time_exec_end, NULL);
585     T_task_exec = ((time_exec_end.tv_sec - time_exec_start.tv_sec) + (time_exec_e
      nd.tv_usec - time_exec_start.tv_usec)*1e-6);
586 
587     t_task_2_global = t_task;
588     T_task_2_mean_global = T_task_mean;
589     T_task_2_min_global = T_task_min;
590     T_task_2_max_global = T_task_max;
591     T_task_2_exec_global = T_task_exec;
592 
593     flag_task_2_firstexecution = 0;
594 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main2_8h_a0e411070b7f487a8ab6a60b180f50e12}{
\index{main2.h@{main2.h}!timer\_\-start\_\-task\_\-1@{timer\_\-start\_\-task\_\-1}}
\index{timer\_\-start\_\-task\_\-1@{timer\_\-start\_\-task\_\-1}!main2.h@{main2.h}}
\subsubsection[{timer\_\-start\_\-task\_\-1}]{\setlength{\rightskip}{0pt plus 5cm}void timer\_\-start\_\-task\_\-1 (void)}}
\label{main2_8h_a0e411070b7f487a8ab6a60b180f50e12}


Definition at line 399 of file main2.c.



References f\_\-timer\_\-task\_\-1(), flag\_\-task\_\-1\_\-firstexecution, task\_\-1\_\-period\_\-us, and timer\_\-task\_\-1.



Referenced by main().




\begin{DoxyCode}
400 {
401     struct itimerspec itimer;
402     struct sigevent sigev;
403     int erno = 0;
404 
405     flag_task_1_firstexecution = 1;
406 
407     itimer.it_interval.tv_sec=0;
408     itimer.it_interval.tv_nsec=task_1_period_us * 1000;
409     itimer.it_value=itimer.it_interval;
410 
411     memset(&sigev, 0, sizeof (struct sigevent));
412 
413     sigev.sigev_value.sival_int = 0;
414     sigev.sigev_notify = SIGEV_THREAD;
415     sigev.sigev_notify_attributes = NULL;
416     sigev.sigev_notify_function = f_timer_task_1;
417 
418     if (timer_create(CLOCK_REALTIME, &sigev, &timer_task_1) < 0)
419     {
420         fprintf(stderr, "[%d]: %s\n", __LINE__, strerror(erno));
421         exit(erno);
422     }
423 
424     if(timer_settime(timer_task_1, 0, &itimer, NULL) < 0)
425     {
426         fprintf(stderr, "[%d]: %s\n", __LINE__, strerror(erno));
427         exit(erno);
428     }
429 
430 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main2_8h_ae59c93969d017f18e3e38b2f9f7888ca}{
\index{main2.h@{main2.h}!timer\_\-start\_\-task\_\-2@{timer\_\-start\_\-task\_\-2}}
\index{timer\_\-start\_\-task\_\-2@{timer\_\-start\_\-task\_\-2}!main2.h@{main2.h}}
\subsubsection[{timer\_\-start\_\-task\_\-2}]{\setlength{\rightskip}{0pt plus 5cm}void timer\_\-start\_\-task\_\-2 (void)}}
\label{main2_8h_ae59c93969d017f18e3e38b2f9f7888ca}


Definition at line 432 of file main2.c.



References f\_\-timer\_\-task\_\-2(), flag\_\-task\_\-2\_\-firstexecution, task\_\-2\_\-period\_\-us, and timer\_\-task\_\-2.



Referenced by main().




\begin{DoxyCode}
433 {
434     struct itimerspec itimer;
435     struct sigevent sigev;
436     int erno = 0;
437 
438     flag_task_2_firstexecution = 1;
439 
440     itimer.it_interval.tv_sec=0;
441     itimer.it_interval.tv_nsec=task_2_period_us * 1000;
442     itimer.it_value=itimer.it_interval;
443 
444     memset (&sigev, 0, sizeof (struct sigevent));
445     sigev.sigev_value.sival_int = 0;
446     sigev.sigev_notify = SIGEV_THREAD;
447     sigev.sigev_notify_attributes = NULL;
448     sigev.sigev_notify_function = f_timer_task_2;
449 
450     if(timer_create(CLOCK_REALTIME, &sigev, &timer_task_2) < 0)
451     {
452         fprintf(stderr, "[%d]: %s\n", __LINE__, strerror(erno));
453         exit(erno);
454     }
455 
456     if(timer_settime(timer_task_2, 0, &itimer, NULL) < 0)
457     {
458         fprintf(stderr, "[%d]: %s\n", __LINE__, strerror(erno));
459         exit(erno);
460     }
461 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main2_8h_a54bb5066619e443a28ae5601b5ea3642}{
\index{main2.h@{main2.h}!timer\_\-stop\_\-task\_\-1@{timer\_\-stop\_\-task\_\-1}}
\index{timer\_\-stop\_\-task\_\-1@{timer\_\-stop\_\-task\_\-1}!main2.h@{main2.h}}
\subsubsection[{timer\_\-stop\_\-task\_\-1}]{\setlength{\rightskip}{0pt plus 5cm}void timer\_\-stop\_\-task\_\-1 (void)}}
\label{main2_8h_a54bb5066619e443a28ae5601b5ea3642}


Definition at line 463 of file main2.c.



References timer\_\-task\_\-1.



Referenced by main().




\begin{DoxyCode}
464 {
465     int erno = 0;
466     if(timer_delete(timer_task_1) < 0)
467     {
468         fprintf(stderr, "[%d]: %s\n", __LINE__, strerror(erno));
469         exit(erno);
470     }
471 }
\end{DoxyCode}




Here is the caller graph for this function:

\hypertarget{main2_8h_a0c69dbcb7b2885a2de116b9d690280de}{
\index{main2.h@{main2.h}!timer\_\-stop\_\-task\_\-2@{timer\_\-stop\_\-task\_\-2}}
\index{timer\_\-stop\_\-task\_\-2@{timer\_\-stop\_\-task\_\-2}!main2.h@{main2.h}}
\subsubsection[{timer\_\-stop\_\-task\_\-2}]{\setlength{\rightskip}{0pt plus 5cm}void timer\_\-stop\_\-task\_\-2 (void)}}
\label{main2_8h_a0c69dbcb7b2885a2de116b9d690280de}


Definition at line 473 of file main2.c.



References timer\_\-task\_\-2.



Referenced by main().




\begin{DoxyCode}
474 {
475     int erno = 0;
476     if(timer_delete(timer_task_2) < 0)
477     {
478         fprintf(stderr, "[%d]: %s\n", __LINE__, strerror(erno));
479         exit(erno);
480     }
481 }
\end{DoxyCode}




Here is the caller graph for this function:

