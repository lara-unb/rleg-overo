\hypertarget{CommunicationV0_2spi__functions_8h}{\section{Communication\-V0/spi\-\_\-functions.h File Reference}
\label{CommunicationV0_2spi__functions_8h}\index{Communication\-V0/spi\-\_\-functions.\-h@{Communication\-V0/spi\-\_\-functions.\-h}}
}
{\ttfamily \#include $<$stdint.\-h$>$}\\*
{\ttfamily \#include $<$unistd.\-h$>$}\\*
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$getopt.\-h$>$}\\*
{\ttfamily \#include $<$fcntl.\-h$>$}\\*
{\ttfamily \#include $<$sys/ioctl.\-h$>$}\\*
{\ttfamily \#include $<$linux/types.\-h$>$}\\*
{\ttfamily \#include $<$linux/spi/spidev.\-h$>$}\\*
Include dependency graph for spi\-\_\-functions.\-h\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{CommunicationV0_2spi__functions_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{CommunicationV0_2spi__functions_8h__dep__incl}
\end{center}
\end{figure}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{CommunicationV0_2spi__functions_8h_a25f003de16c08a4888b69f619d70f427}{A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E}(a)~(sizeof(a) / sizeof((a)\mbox{[}0\mbox{]}))
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__spi_ga70764aca888e93b0329e7a62c9312704}{spi\-\_\-init} (uint8\-\_\-t mode, uint32\-\_\-t speed, uint8\-\_\-t cs)
\begin{DoxyCompactList}\small\item\em I\-N\-I\-T\-I\-A\-L\-I\-Z\-E S\-P\-I D\-E\-V\-I\-C\-E. \end{DoxyCompactList}\item 
void \hyperlink{group__spi_ga3fb02c6fc5990df81645306a81291624}{spi\-\_\-end} (int \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\-\_\-dev})
\begin{DoxyCompactList}\small\item\em T\-E\-R\-M\-I\-N\-A\-T\-E\-S S\-P\-I D\-E\-V\-I\-C\-E. \end{DoxyCompactList}\item 
short int \hyperlink{CommunicationV0_2spi__functions_8h_a405e3e13b63a628c1be12ccba7e2ebbf}{adc\-\_\-read} (int \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\-\_\-dev}, uint8\-\_\-t ch, uint8\-\_\-t sgl)
\item 
uint8\-\_\-t \hyperlink{group__spi_ga5c52e64c336d59215ce0a4b6f340dc9f}{dac\-\_\-write} (int \hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\-\_\-dev}, uint8\-\_\-t ch, uint8\-\_\-t \-\_\-shdn, unsigned short int data)
\begin{DoxyCompactList}\small\item\em W\-R\-I\-T\-E D\-A\-T\-A T\-O D/\-A C\-O\-N\-V\-E\-R\-T\-E\-R M\-C\-P3922. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{CommunicationV0_2spi__functions_8h_a25f003de16c08a4888b69f619d70f427}{\index{Communication\-V0/spi\-\_\-functions.\-h@{Communication\-V0/spi\-\_\-functions.\-h}!A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E@{A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E}}
\index{A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E@{A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E}!CommunicationV0/spi_functions.h@{Communication\-V0/spi\-\_\-functions.\-h}}
\subsubsection[{A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E}]{\setlength{\rightskip}{0pt plus 5cm}\#define A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E(
\begin{DoxyParamCaption}
\item[{}]{a}
\end{DoxyParamCaption}
)~(sizeof(a) / sizeof((a)\mbox{[}0\mbox{]}))}}\label{CommunicationV0_2spi__functions_8h_a25f003de16c08a4888b69f619d70f427}


Definition at line 29 of file spi\-\_\-functions.\-h.



\subsection{Function Documentation}
\hypertarget{CommunicationV0_2spi__functions_8h_a405e3e13b63a628c1be12ccba7e2ebbf}{\index{Communication\-V0/spi\-\_\-functions.\-h@{Communication\-V0/spi\-\_\-functions.\-h}!adc\-\_\-read@{adc\-\_\-read}}
\index{adc\-\_\-read@{adc\-\_\-read}!CommunicationV0/spi_functions.h@{Communication\-V0/spi\-\_\-functions.\-h}}
\subsubsection[{adc\-\_\-read}]{\setlength{\rightskip}{0pt plus 5cm}short int adc\-\_\-read (
\begin{DoxyParamCaption}
\item[{int}]{spi\-\_\-dev, }
\item[{uint8\-\_\-t}]{ch, }
\item[{uint8\-\_\-t}]{sgl}
\end{DoxyParamCaption}
)}}\label{CommunicationV0_2spi__functions_8h_a405e3e13b63a628c1be12ccba7e2ebbf}


Definition at line 165 of file spi\-\_\-functions.\-c.



References A\-R\-R\-A\-Y\-\_\-\-S\-I\-Z\-E, delay, and pabort().


\begin{DoxyCode}
\{
        \textcolor{keywordtype}{int} ret;
        \textcolor{keywordflow}{if}( ch<0 || ch>7 ) \textcolor{keywordflow}{return} \hyperlink{communication_2spi__functions_8c_aabfca8320b0c76774f01467703e17302}{pabort}(\textcolor{stringliteral}{"Wrong channel value for ADC"});
        uint8\_t tx[] = \{(ch>>2)|(sgl<<1)|0x04, ch<<6, 0x00,\};
        uint8\_t rx[\hyperlink{communication_2spi__functions_8h_a25f003de16c08a4888b69f619d70f427}{ARRAY\_SIZE}(tx)] = \{0, \};
        \textcolor{keyword}{struct }spi\_ioc\_transfer tr = \{
                .tx\_buf = (\textcolor{keywordtype}{unsigned} long)tx,
                .rx\_buf = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})rx,
                .len = \hyperlink{communication_2spi__functions_8h_a25f003de16c08a4888b69f619d70f427}{ARRAY\_SIZE}(tx),
                .delay\_usecs = \hyperlink{CommunicationV0_2spi__functions_8c_adc4674f6ea53803d98fa2ec36759e77d}{delay},
                .speed\_hz = 0,
                .bits\_per\_word = 0,
        \};

        ret = ioctl(\hyperlink{CommunicationV0_2communication_8c_a4788f0a5355494bc6c13690e28f43783}{spi\_dev}, SPI\_IOC\_MESSAGE(1), &tr);
        \textcolor{keywordflow}{if} (ret == 1) \textcolor{keywordflow}{return} \hyperlink{communication_2spi__functions_8c_aabfca8320b0c76774f01467703e17302}{pabort}(\textcolor{stringliteral}{"can't send spi message"});
\textcolor{comment}{//printf("\(\backslash\)nRx = 0x%X 0x%X 0x%X\(\backslash\)n",rx[0],rx[1],rx[2]);}
\textcolor{comment}{//printf("\(\backslash\)nValor retornado pelo conversor AD:
       %d\(\backslash\)n\(\backslash\)n",rx[2]+((rx[1]&0x0F)<<8));}
        \textcolor{keywordflow}{return} rx[2]+((rx[1]&0x0F)<<8);
\}
\end{DoxyCode}


Here is the call graph for this function\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=216pt]{CommunicationV0_2spi__functions_8h_a405e3e13b63a628c1be12ccba7e2ebbf_cgraph}
\end{center}
\end{figure}


