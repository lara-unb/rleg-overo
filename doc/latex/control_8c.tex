\hypertarget{control_8c}{\section{control/control.c File Reference}
\label{control_8c}\index{control/control.\-c@{control/control.\-c}}
}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{control_8c_affcc9c00d6ed4b976ae2d0e53b60f51f}{control\-\_\-main} (\hyperlink{threads__linux_8c_a2a2a647912528f7aa86812528dbfe02f}{t\-\_\-task\-\_\-1\-\_\-global},\&\hyperlink{threads__linux_8c_a3cfea12cbe9ca7f1681c950e4cd68606}{imu\-\_\-data},\&\hyperlink{main2_8c_a5650ece8c3a277c7f158d75ae65265fa}{eff\-\_\-data},\&\hyperlink{main2_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\-\_\-data})
\begin{DoxyCompactList}\small\item\em Function\-: control\-\_\-main Summary\-: Calculate the control signal. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{control_8c_affcc9c00d6ed4b976ae2d0e53b60f51f}{\index{control.\-c@{control.\-c}!control\-\_\-main@{control\-\_\-main}}
\index{control\-\_\-main@{control\-\_\-main}!control.c@{control.\-c}}
\subsubsection[{control\-\_\-main}]{\setlength{\rightskip}{0pt plus 5cm}void control\-\_\-main (
\begin{DoxyParamCaption}
\item[{{\bf t\-\_\-task\-\_\-1\-\_\-global}}]{, }
\item[{\&}]{imu\-\_\-data, }
\item[{\&}]{eff\-\_\-data, }
\item[{\&}]{mra\-\_\-data}
\end{DoxyParamCaption}
)}}\label{control_8c_affcc9c00d6ed4b976ae2d0e53b60f51f}


Function\-: control\-\_\-main Summary\-: Calculate the control signal. 


\begin{DoxyParams}{Parameters}
{\em t\-\_\-task\-\_\-1\-\_\-global} & containing the ... \\
\hline
{\em imu\-\_\-data} & containing data from accelerometer, gyrometer and magnetometer \\
\hline
{\em eff\-\_\-data} & containing data from load cell \\
\hline
{\em mra\-\_\-data} & struct containing the control signal\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
nothing 
\end{DoxyReturn}


Definition at line 11 of file control.\-c.



References I\-M\-U\-\_\-\-D\-A\-T\-A\-\_\-\-S\-T\-R\-U\-C\-T\-::acc, imu\-\_\-data, mra\-\_\-data, M\-R\-A\-\_\-\-D\-A\-T\-A\-\_\-\-S\-T\-R\-U\-C\-T\-::v\-\_\-ctl, D\-A\-T\-A\-\_\-\-X\-Y\-Z\-::x, and D\-A\-T\-A\-\_\-\-X\-Y\-Z\-::z.


\begin{DoxyCode}
                                                                    \{
\textcolor{keywordtype}{int} t\_gait = 0;
\textcolor{keywordtype}{int} gait\_cycle = 2000000;\textcolor{comment}{//Gait cycle takes 2 seconds}
\textcolor{keywordtype}{int} heelstrike\_threshold = 3;

        \textcolor{comment}{//In case of heel strike the gait cycle starts}
        \textcolor{comment}{//Heel strike detection: module of acceleration vector (which has
       components in x and z axis) higher than threshold.}
        \textcolor{keywordflow}{if} ((((\hyperlink{main2_8c_a3cfea12cbe9ca7f1681c950e4cd68606}{imu\_data}->\hyperlink{structIMU__DATA__STRUCT_a448f284bf44eb503affda586ad5fa9d2}{acc}.\hyperlink{structDATA__XYZ_a54c1596e9f9969fd9c21e8458024ecfb}{x})^2 + (\hyperlink{main2_8c_a3cfea12cbe9ca7f1681c950e4cd68606}{imu\_data}->\hyperlink{structIMU__DATA__STRUCT_a448f284bf44eb503affda586ad5fa9d2}{acc}.\hyperlink{structDATA__XYZ_a69e89ab0ec6e5d72fc5d54f62cc07fb5}{z})^2
      )^0.5) > heelstrike\_threshold)\{
          t\_gait = 0;
        \textcolor{comment}{//Between 10% and 60% of the gait cycle, actuation voltage is 0V}
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (t\_gait>(0.1*gait\_cycle) && t\_gait<=(0.6*gait\_cycle))\{
          \textcolor{comment}{//control voltage 0V}
          \hyperlink{main2_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\_data}.\hyperlink{structMRA__DATA__STRUCT_a64b4e6bb604e58de593a60c87942b966}{v\_ctl}=0;
        \textcolor{comment}{//More than 60% of the gait cycle, set actuation voltage to 4V.}
        \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (t\_gait>(0.6*gait\_cycle) && t\_gait<(0.8*gait\_cycle))\{
          \hyperlink{main2_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\_data}.\hyperlink{structMRA__DATA__STRUCT_a64b4e6bb604e58de593a60c87942b966}{v\_ctl}=4000;
        \}

\}
\end{DoxyCode}
