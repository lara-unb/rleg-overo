\hypertarget{group__gyr}{
\section{Functions for Gyrometer ITG3200}
\label{group__gyr}\index{Functions for Gyrometer ITG3200@{Functions for Gyrometer ITG3200}}
}


Collaboration diagram for Functions for Gyrometer ITG3200:

\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{group__gyr_ga3eba167b8ab0614bfe7bafeae8b5570d}{gyr\_\-write\_\-reg} (int i2c\_\-dev, uint8\_\-t reg, uint8\_\-t data)
\begin{DoxyCompactList}\small\item\em WRITE TO REGISTER. \item\end{DoxyCompactList}\item 
uint8\_\-t $\ast$ \hyperlink{group__gyr_gad817a3b69d4c3026b7a9b6de32753e7b}{gyr\_\-read\_\-reg} (int i2c\_\-dev, uint8\_\-t reg, uint8\_\-t count)
\begin{DoxyCompactList}\small\item\em READ COUNT 8-\/BIT REGISTER IN SEQUENCE. \item\end{DoxyCompactList}\item 
int \hyperlink{group__gyr_ga6d02be352b4491a236c9695a6a24d174}{gyr\_\-init} (int i2c\_\-dev, float rate, short int lpf\_\-bw, char clk\_\-source, char $\ast$act)
\begin{DoxyCompactList}\small\item\em INITIALIZE GYROMETER. \item\end{DoxyCompactList}\item 
int \hyperlink{group__gyr_ga79875465c3a29fd9ec77308c80a8bc37}{gyr\_\-read\_\-all\_\-data} (int i2c\_\-dev, short int $\ast$data)
\begin{DoxyCompactList}\small\item\em READ ALL DATA AT ONCE (X, Y, Z and T). \item\end{DoxyCompactList}\item 
short int \hyperlink{group__gyr_ga271b37e9ace81b18bb2f83787247d262}{gyr\_\-read\_\-data} (int i2c\_\-dev, int type)
\begin{DoxyCompactList}\small\item\em READ DATA (X, Y, Z or T). \item\end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{group__gyr_ga6d02be352b4491a236c9695a6a24d174}{
\index{gyr@{gyr}!gyr\_\-init@{gyr\_\-init}}
\index{gyr\_\-init@{gyr\_\-init}!gyr@{gyr}}
\subsubsection[{gyr\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}int gyr\_\-init (int {\em i2c\_\-dev}, \/  float {\em rate}, \/  short int {\em lpf\_\-bw}, \/  char {\em clk\_\-source}, \/  char $\ast$ {\em act})}}
\label{group__gyr_ga6d02be352b4491a236c9695a6a24d174}


INITIALIZE GYROMETER. 


\begin{DoxyParams}{Parameters}
\item[{\em lpf\_\-bw}](low pass filter bandwidth in Hz) = 256, 188, 98, 42, 20, 10 or 5 \item[{\em rate}](output data rate in Hz) $<$= 1000 (Fint), if lpf\_\-bw is not 256 $<$= 8000 (Fint), if lpf\_\-bw is 256 Real rate will be the closest superior rate possible, respcting the formula Rate = Fint/n, 1$<$=n$<$=255 \item[{\em clk\_\-source}]= 'I' Internal oscillator 'X' PLL with X Gyro reference 'Y' PLL with Y Gyro reference 'Z' Pll with Z Gyro reference Obs: It is highly recommended that the device is configured to use one of the gyros as the clock reference, due to the improved stability \item[{\em act}](activated gyro data) = \char`\"{}XYZ\char`\"{} All axes are activated \char`\"{}YZ\char`\"{} Only Y and Z axes are activated \char`\"{}XZ\char`\"{} Only X and Z axes are activated \char`\"{}XY\char`\"{} Only X and Y axes are activated \char`\"{}X\char`\"{} Only X axis is activated \char`\"{}Y\char`\"{} Only Y axis is activated \char`\"{}Z\char`\"{} Only Z axis is activated \char`\"{}\char`\"{} Device in very low power sleep mode \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Data of register or NULL in case of any trouble 
\end{DoxyReturn}


Definition at line 53 of file gyr\_\-functions.c.



References GYR\_\-DLPF\_\-FS, GYR\_\-PWR\_\-MGM, GYR\_\-SMPLRT\_\-DIV, and gyr\_\-write\_\-reg().



Referenced by devices\_\-init().




\begin{DoxyCode}
54 { 
55   uint8_t data=0;
56   float Fint=1000;
57 
58   switch(lpf_bw){
59     case 256:
60       Fint=8000;
61       data=0x18;
62       break;
63     case 188:
64       data=0x19;
65       break;
66     case 98:
67       data=0x1A;
68       break;
69     case 42:
70       data=0x1B;
71       break;
72     case 20:
73       data=0x1C;
74       break;
75     case 10:
76       data=0x1D;
77       break;
78     case 5:
79       data=0x1E;
80       break;
81     default:
82       perror("Wrong low pass filter bandwidth value");
83       break;
84   }
85   
86   if(gyr_write_reg(i2c_dev, GYR_DLPF_FS, data)<0){
87     perror("Write in Configuration register A unsuccesful");
88     return -1;
89   }
90 
91   if( (rate>Fint)||(rate<0) )
92   {
93     perror("Wrong choice for rate");
94     return -1;
95   }
96   data=(uint8_t)(Fint/rate - 1);
97   
98   if(gyr_write_reg(i2c_dev, GYR_SMPLRT_DIV, data)<0){
99     perror("Write in configuration register B unsuccesful");
100     return -1;
101   }
102       
103   switch(clk_source){
104     case 'I':
105       data=0x00;
106       break;
107     case 'X':
108       data=0x01;
109       break;
110     case 'Y':
111       data=0x02;
112       break;
113     case 'Z':
114       data=0x03;
115       break;
116     default:
117       perror("Wrong clk_source value");
118       break;
119   }
120       
121   if( strcmp(act,"XYZ")==0 );
122   else if( strcmp(act,"YZ")==0 )
123       data=data|0x20;
124   else if( strcmp(act,"")==0 )
125       data=data|0x40;
126   else if( strcmp(act,"Y")==0 )
127       data=data|0x28;
128   else if( strcmp(act,"Z")==0 )
129       data=data|0x30;
130   else if( strcmp(act,"X")==0 )
131       data=data|0x18;
132   else if( strcmp(act,"XY")==0 )
133       data=data|0x08;
134   else if( strcmp(act,"XZ")==0 )
135       data=data|0x10;
136   else{
137     perror("Wrong act value in gyrometer initialization");
138     return -1;
139   }
140    
141   if(gyr_write_reg(i2c_dev, GYR_PWR_MGM, data)<0){
142     perror("Write in mode register unsuccesful");
143     return -1;
144   }
145   
146   return 1;
147 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{group__gyr_ga79875465c3a29fd9ec77308c80a8bc37}{
\index{gyr@{gyr}!gyr\_\-read\_\-all\_\-data@{gyr\_\-read\_\-all\_\-data}}
\index{gyr\_\-read\_\-all\_\-data@{gyr\_\-read\_\-all\_\-data}!gyr@{gyr}}
\subsubsection[{gyr\_\-read\_\-all\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}int gyr\_\-read\_\-all\_\-data (int {\em i2c\_\-dev}, \/  short int $\ast$ {\em data})}}
\label{group__gyr_ga79875465c3a29fd9ec77308c80a8bc37}


READ ALL DATA AT ONCE (X, Y, Z and T). 


\begin{DoxyParams}{Parameters}
\item[{\em i2c\_\-dev}]\item[\mbox{$\rightarrow$} {\em $\ast$data}]Vector with all data \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Flag with SUCCESS or FAILURE 
\end{DoxyReturn}


Definition at line 149 of file gyr\_\-functions.c.



References FAILURE, gyr\_\-read\_\-reg(), GYR\_\-TEMP\_\-OUT\_\-H, and SUCCESS.



Referenced by read\_\-all\_\-data().




\begin{DoxyCode}
150 {
151   uint8_t i;
152   uint8_t *data8;
153   union result
154   {
155     unsigned short int usgnd[4];
156     int short sgnd[4];
157   } result;
158   if( (data8=gyr_read_reg(i2c_dev,GYR_TEMP_OUT_H,8))==NULL)
159   {
160     //perror("Read accelerometer register failed");
161     return FAILURE;
162   }
163   // Result receives gyro data:
164   for(i=1; i<4; i++)
165   {
166     result.usgnd[i-1]=0;
167     result.usgnd[i-1]=result.usgnd[i-1]|((unsigned short int)data8[i*2+1])|(((uns
      igned int)data8[i*2])<<8);
168     data[i-1]=result.sgnd[i-1];
169   }
170   // Result receives temperature data:
171   result.usgnd[3]=0;
172   result.usgnd[3]=result.usgnd[3]|((unsigned short int)data8[1])|(((unsigned int)
      data8[0])<<8);  
173   data[3]=result.sgnd[3];
174   return SUCCESS;  
175 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{group__gyr_ga271b37e9ace81b18bb2f83787247d262}{
\index{gyr@{gyr}!gyr\_\-read\_\-data@{gyr\_\-read\_\-data}}
\index{gyr\_\-read\_\-data@{gyr\_\-read\_\-data}!gyr@{gyr}}
\subsubsection[{gyr\_\-read\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}short int gyr\_\-read\_\-data (int {\em i2c\_\-dev}, \/  int {\em type})}}
\label{group__gyr_ga271b37e9ace81b18bb2f83787247d262}


READ DATA (X, Y, Z or T). 


\begin{DoxyParams}{Parameters}
\item[{\em i2c\_\-dev}]\item[{\em type}]Define kind of read: 'X' or 'Y' or 'Z' or 'T'(temperature) \end{DoxyParams}
\begin{DoxyReturn}{Returns}
Data 
\end{DoxyReturn}


Definition at line 177 of file gyr\_\-functions.c.



References GYR\_\-GYRO\_\-XOUT\_\-H, GYR\_\-GYRO\_\-YOUT\_\-H, GYR\_\-GYRO\_\-ZOUT\_\-H, gyr\_\-read\_\-reg(), and GYR\_\-TEMP\_\-OUT\_\-H.




\begin{DoxyCode}
178 {
179   uint8_t *data;
180   union result
181   {
182     unsigned int usgnd;
183     int sgnd;
184   }result;
185 
186   switch(type){
187     case 'X':
188       data=gyr_read_reg(i2c_dev,GYR_GYRO_XOUT_H,2);
189       break;
190     case 'Y':
191       data=gyr_read_reg(i2c_dev,GYR_GYRO_YOUT_H,2);
192       break;
193     case 'Z':
194       data=gyr_read_reg(i2c_dev,GYR_GYRO_ZOUT_H,2);
195       break;
196     case 'T':
197       data=gyr_read_reg(i2c_dev,GYR_TEMP_OUT_H,2);
198     default:
199       //perror("Wrong argument for type in gyr_read_data");
200       return -1;
201   }
202   result.usgnd=0;
203   result.usgnd=result.usgnd|(((unsigned short int)data[1]))|(((unsigned short int
      )data[0])<<8);
204   return result.sgnd;
205 }
\end{DoxyCode}




Here is the call graph for this function:

\hypertarget{group__gyr_gad817a3b69d4c3026b7a9b6de32753e7b}{
\index{gyr@{gyr}!gyr\_\-read\_\-reg@{gyr\_\-read\_\-reg}}
\index{gyr\_\-read\_\-reg@{gyr\_\-read\_\-reg}!gyr@{gyr}}
\subsubsection[{gyr\_\-read\_\-reg}]{\setlength{\rightskip}{0pt plus 5cm}uint8\_\-t$\ast$ gyr\_\-read\_\-reg (int {\em i2c\_\-dev}, \/  uint8\_\-t {\em reg}, \/  uint8\_\-t {\em count})}}
\label{group__gyr_gad817a3b69d4c3026b7a9b6de32753e7b}


READ COUNT 8-\/BIT REGISTER IN SEQUENCE. 


\begin{DoxyParams}{Parameters}
\item[{\em reg}]Register \item[{\em count}]number of registers in sequence \end{DoxyParams}
\begin{DoxyReturn}{Returns}
flag with SUCCESS or FAILURE 
\end{DoxyReturn}
\begin{Desc}
\item[\hyperlink{todo__todo000002}{Todo}]Verify use of reg parameter \end{Desc}


Definition at line 31 of file gyr\_\-functions.c.



Referenced by gyr\_\-read\_\-all\_\-data(), and gyr\_\-read\_\-data().




\begin{DoxyCode}
32 {
33   uint8_t data[9];
34   int i;
35 
36   //data=(uint8_t*)malloc((count+1)*sizeof(data));
37   
38   data[0] = reg;
39 
40   if (write(i2c_dev, &data, 1) != 1) {           
41         //perror("write before read");
42         return NULL;
43   }
44   data[0] = 0;
45   if (read(i2c_dev, &data, count) != count) {
46         //perror("read");
47         return NULL;    
48   }
49 
50   return data;
51 }
\end{DoxyCode}




Here is the caller graph for this function:

\hypertarget{group__gyr_ga3eba167b8ab0614bfe7bafeae8b5570d}{
\index{gyr@{gyr}!gyr\_\-write\_\-reg@{gyr\_\-write\_\-reg}}
\index{gyr\_\-write\_\-reg@{gyr\_\-write\_\-reg}!gyr@{gyr}}
\subsubsection[{gyr\_\-write\_\-reg}]{\setlength{\rightskip}{0pt plus 5cm}int gyr\_\-write\_\-reg (int {\em i2c\_\-dev}, \/  uint8\_\-t {\em reg}, \/  uint8\_\-t {\em data})}}
\label{group__gyr_ga3eba167b8ab0614bfe7bafeae8b5570d}


WRITE TO REGISTER. 


\begin{DoxyParams}{Parameters}
\item[{\em i2c\_\-dev}]\item[{\em reg}]Register \item[{\em data}]Data to write in Register\end{DoxyParams}
\begin{DoxyAuthor}{Author}
Caio Gustavo Mesquita Ã‚ngelo Rev 0 -\/ 12/11/2012 RLEG project -\/ 2012
\end{DoxyAuthor}
Implements the I2C communication between Gumstix Overo Fire and ITG3200 

Definition at line 10 of file gyr\_\-functions.c.



References FAILURE, GYR\_\-INT\_\-CFG, GYR\_\-PWR\_\-MGM, GYR\_\-SMPLRT\_\-DIV, GYR\_\-WHO\_\-AM\_\-I, and SUCCESS.



Referenced by gyr\_\-init().




\begin{DoxyCode}
11 {
12   uint8_t reg_data[2];
13 
14   reg_data[0] = reg;
15   reg_data[1] = data;
16 
17   if( !( (reg==GYR_WHO_AM_I)||((GYR_SMPLRT_DIV<=reg)&&(reg<=GYR_INT_CFG))||(reg==
      GYR_PWR_MGM) ) )
18   {
19       //perror("Write unsucessful: Not a valid writable register");
20       return FAILURE;
21   }
22         
23   if (write(i2c_dev, &reg_data, 2) != 2) {               
24           //perror("Write unsuccessful");
25           return FAILURE;
26   }
27 
28   return SUCCESS;
29 }
\end{DoxyCode}




Here is the caller graph for this function:

