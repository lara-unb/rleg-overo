\hypertarget{main_8c}{\section{main.\-c File Reference}
\label{main_8c}\index{main.\-c@{main.\-c}}
}
{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include \char`\"{}Communication/communication.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}main.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}task\-Scheduler.\-h\char`\"{}}\\*
Include dependency graph for main.\-c\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\item 
void \hyperlink{main_8c_a8007959bfd1230feb2298965e39f2a70}{ui\-\_\-task} ()
\item 
void \hyperlink{main_8c_a5f05ce725141ddfab683e059b1cd95ea}{exit\-\_\-program} (void)
\begin{DoxyCompactList}\small\item\em Internal function to end program. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structTASK__S}{T\-A\-S\-K\-\_\-\-S} \hyperlink{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{task1}
\begin{DoxyCompactList}\small\item\em Main rotine for control\-: \end{DoxyCompactList}\item 
\hyperlink{structTASK__S}{T\-A\-S\-K\-\_\-\-S} \hyperlink{main_8c_a432cbf231acb83d48e31879bd7afc71a}{task2}
\item 
\hyperlink{structIMU__PARAM__STRUCT}{I\-M\-U\-\_\-\-P\-A\-R\-A\-M\-\_\-\-S\-T\-R\-U\-C\-T} \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\-\_\-param}
\item 
\hyperlink{structSPI__PARAM__STRUCT}{S\-P\-I\-\_\-\-P\-A\-R\-A\-M\-\_\-\-S\-T\-R\-U\-C\-T} \hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\-\_\-param}
\item 
I\-M\-U\-\_\-\-D\-A\-T\-A\-\_\-\-S\-T\-R\-U\-T \hyperlink{main_8c_a0f81e5b5621e6e2b2467daa7d12268c4}{imu\-\_\-data}
\item 
\hyperlink{structENC__DATA__STRUCT}{E\-N\-C\-\_\-\-D\-A\-T\-A\-\_\-\-S\-T\-R\-U\-C\-T} \hyperlink{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}{enc\-\_\-data}
\item 
int \hyperlink{main_8c_ac7af894858cf396a219d632f40afdc8d}{total} = 0
\item 
int \hyperlink{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}{failure} = 0
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{main_8c_a5f05ce725141ddfab683e059b1cd95ea}{\index{main.\-c@{main.\-c}!exit\-\_\-program@{exit\-\_\-program}}
\index{exit\-\_\-program@{exit\-\_\-program}!main.c@{main.\-c}}
\subsubsection[{exit\-\_\-program}]{\setlength{\rightskip}{0pt plus 5cm}void exit\-\_\-program (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{main_8c_a5f05ce725141ddfab683e059b1cd95ea}


Internal function to end program. 



Definition at line 99 of file main.\-c.



Referenced by ui\-\_\-update().


\begin{DoxyCode}
99                        \{
100   \hyperlink{main2_8c_a525dcecf4685bea1fbf92651ac0401fe}{quittask} = 1;
101   \textcolor{keywordflow}{return};
102 \}
\end{DoxyCode}


Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c_a5f05ce725141ddfab683e059b1cd95ea_icgraph}
\end{center}
\end{figure}


\hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{\index{main.\-c@{main.\-c}!main@{main}}
\index{main@{main}!main.c@{main.\-c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{main_8c_a840291bc02cba5474a4cb46a9b9566fe}


Definition at line 27 of file main.\-c.


\begin{DoxyCode}
27               \{
28   \textcolor{keywordtype}{int} return\_value = \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};
29 
30 \textcolor{comment}{/*Setting config values:*/}
31   \textcolor{comment}{// Parameters for IMU}
32   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a92172e4757d0f8f9135a659e406c12e5}{acc}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__acc_af57da5d956ffa7e49a184326b6b9c738}{full\_res}=1;
33   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a92172e4757d0f8f9135a659e406c12e5}{acc}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__acc_a30e6a318cad098cd8379416705820f95}{rate}=100;
34   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a92172e4757d0f8f9135a659e406c12e5}{acc}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__acc_a26199b298ef2d353192dfbc706bce8cf}{range}=16;
35   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a5a4557868f1af679a1098808397b02ec}{gyr}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__gyr_a5aa70e1e9634411c89aacfbc570cc91c}{rate}=100;
36   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a5a4557868f1af679a1098808397b02ec}{gyr}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__gyr_aa612f7299b43a1bf1fc597688c2fa02d}{lpf\_bw}=188;
37   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a5a4557868f1af679a1098808397b02ec}{gyr}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__gyr_aca3b791cb480f2da4703d4c256a7de48}{clk\_source}=\textcolor{charliteral}{'Z'};
38   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a5a4557868f1af679a1098808397b02ec}{gyr}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__gyr_a909d153e794ec443be04625ce00e4178}{act}=\textcolor{stringliteral}{"XYZ"};
39   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a26b277dcaf05f3842995df888225f6f4}{mag}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__mag_a234de95423b604b05b851ef90890cea1}{rate}=75;
40   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a26b277dcaf05f3842995df888225f6f4}{mag}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__mag_a40ad27ebdb5fde35257b1dc52e40f476}{range}=0;
41   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a26b277dcaf05f3842995df888225f6f4}{mag}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__mag_a52c22cae6940eb39fb72aca66cfeba9a}{samples\_avg}=8;
42   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a26b277dcaf05f3842995df888225f6f4}{mag}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__mag_a1f3536709c05310005d648f339d70c54}{meas\_mode}=0;
43   \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a26b277dcaf05f3842995df888225f6f4}{mag}.\hyperlink{structIMU__PARAM__STRUCT_1_1param__mag_a39b83b3e9ff5bdcafed0bdf6a2de584b}{op\_mode}=0;
44 
45   \textcolor{comment}{// Parameters for SPI}
46   \hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_param}.\hyperlink{structSPI__PARAM__STRUCT_a82c546c99f6c3daed73c1e23426be847}{mode}=0;
47   \hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_param}.\hyperlink{structSPI__PARAM__STRUCT_a53a8d386594a81eb9bc6f971bfe36c54}{speed}=375000;
48   \hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_param}.\hyperlink{structSPI__PARAM__STRUCT_ae0d62e0a5554783d710b677a017e246f}{cs}=0;
49 
50   \textcolor{comment}{// Task for control UI:}
51   \hyperlink{taskScheduler_8c_a2346be42760ac3f89c3e9e9414d83645}{timer\_new\_task}(&\hyperlink{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{task1},\hyperlink{main_8c_a8007959bfd1230feb2298965e39f2a70}{ui\_task});
52   \textcolor{comment}{//timer\_new\_task(task2,ui\_task);}
53 
54 
55 \textcolor{comment}{/*Initialization:*/}
56   \textcolor{keywordflow}{if}(\hyperlink{communication_2communication_8c_a2d1e523ff70db11ca4096f97af5da000}{devices\_init}(&\hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param},&\hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_param},&\hyperlink{main2_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\_data})!=
      \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS})\{
57     perror(\textcolor{stringliteral}{"Unsuccesful devices initialization"});
58     \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE};
59   \}
60 
61   \textcolor{keywordflow}{if}(\hyperlink{group__ui_gab7bfb453918dcc296ff0cea3c79453d0}{ui\_init}()!=\hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS})\{
62     perror(\textcolor{stringliteral}{"Unsuccesful user interface initialization"});
63     \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE};
64   \}
65 
66   \hyperlink{group__taskS_gac088a054258396a6e2dba77908f22b42}{timer\_start\_task}(&\hyperlink{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{task1});
67   \textcolor{comment}{//timer\_start\_task(task2);}
68 
69   \textcolor{keywordflow}{while}(return\_value == \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS})\{
70     \hyperlink{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{task1}->runFunction();
71   \}
72 
73 \textcolor{comment}{/*Shutting Down:*/}
74   \hyperlink{group__taskS_ga8e48eacaac7d9cf7d82cc71cfbcd4b56}{timer\_stop\_task}(&\hyperlink{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{task1});
75   \textcolor{comment}{//usleep(2000);}
76 
77   \textcolor{keywordflow}{if}(\hyperlink{group__ui_ga65d8b92b634da17c344458cd57e61f3e}{ui\_close}()==\hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE})\{
78     return\_value == \hyperlink{calibration_2calibration_8h_a6d58f9ac447476b4e084d7ca383f5183}{FAILURE};
79   \}
80 
81   close(\hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a8a870f383fc9ba0b682fdc9b8c0d2734}{i2c\_dev});
82   close(\hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_param}.\hyperlink{structSPI__PARAM__STRUCT_abe385c44333d268d17cf648c8e371cad}{spi\_dev});
83 
84   \textcolor{keywordflow}{return} return\_value;
85 \}
\end{DoxyCode}
\hypertarget{main_8c_a8007959bfd1230feb2298965e39f2a70}{\index{main.\-c@{main.\-c}!ui\-\_\-task@{ui\-\_\-task}}
\index{ui\-\_\-task@{ui\-\_\-task}!main.c@{main.\-c}}
\subsubsection[{ui\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}void ui\-\_\-task (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{main_8c_a8007959bfd1230feb2298965e39f2a70}


Definition at line 87 of file main.\-c.



References eff\-\_\-data, failure, I\-M\-U\-\_\-\-P\-A\-R\-A\-M\-\_\-\-S\-T\-R\-U\-C\-T\-::i2c\-\_\-dev, imu\-\_\-data, mra\-\_\-data, read\-\_\-all\-\_\-data(), S\-P\-I\-\_\-\-P\-A\-R\-A\-M\-\_\-\-S\-T\-R\-U\-C\-T\-::spi\-\_\-dev, S\-U\-C\-C\-E\-S\-S, total, and ui\-\_\-update().



Referenced by main().


\begin{DoxyCode}
87               \{
88   \hyperlink{main_8c_ac7af894858cf396a219d632f40afdc8d}{total}++;
89 
90   \textcolor{keywordflow}{if}(\hyperlink{communication_2communication_8c_a26f82e8af3b5ce23d5cd3a41db6e0b68}{read\_all\_data}(\hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_param}.\hyperlink{structIMU__PARAM__STRUCT_a8a870f383fc9ba0b682fdc9b8c0d2734}{i2c\_dev}, \hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_param}.
      \hyperlink{structSPI__PARAM__STRUCT_abe385c44333d268d17cf648c8e371cad}{spi\_dev}, &\hyperlink{main_8c_a0f81e5b5621e6e2b2467daa7d12268c4}{imu\_data},&\hyperlink{main2_8c_a5650ece8c3a277c7f158d75ae65265fa}{eff\_data}, &\hyperlink{main2_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\_data}, &
      \hyperlink{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}{enc\_data}) != \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS}) \hyperlink{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}{failure}++;
91 
92   \hyperlink{group__ui_ga42e4dac2d138061a74c572358c8ebf49}{ui\_update}(&\hyperlink{main_8c_a0f81e5b5621e6e2b2467daa7d12268c4}{imu\_data}, &\hyperlink{main2_8c_a5650ece8c3a277c7f158d75ae65265fa}{eff\_data}, &\hyperlink{main2_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\_data},&
      \hyperlink{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}{enc\_data}, \hyperlink{main_8c_ac7af894858cf396a219d632f40afdc8d}{total}, \hyperlink{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}{failure});
93   \textcolor{keywordflow}{return} \hyperlink{calibration_2calibration_8h_aa90cac659d18e8ef6294c7ae337f6b58}{SUCCESS};
94 \}
\end{DoxyCode}


Here is the call graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{main_8c_a8007959bfd1230feb2298965e39f2a70_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=202pt]{main_8c_a8007959bfd1230feb2298965e39f2a70_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\hypertarget{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}{\index{main.\-c@{main.\-c}!enc\-\_\-data@{enc\-\_\-data}}
\index{enc\-\_\-data@{enc\-\_\-data}!main.c@{main.\-c}}
\subsubsection[{enc\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}{\bf E\-N\-C\-\_\-\-D\-A\-T\-A\-\_\-\-S\-T\-R\-U\-C\-T} enc\-\_\-data}}\label{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}


Definition at line 21 of file main.\-c.

\hypertarget{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}{\index{main.\-c@{main.\-c}!failure@{failure}}
\index{failure@{failure}!main.c@{main.\-c}}
\subsubsection[{failure}]{\setlength{\rightskip}{0pt plus 5cm}int failure = 0}}\label{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}


Definition at line 25 of file main.\-c.



Referenced by periodic\-\_\-task\-\_\-1(), periodic\-\_\-task\-\_\-2(), threads\-\_\-linux\-\_\-periodic\-\_\-task\-\_\-1(), threads\-\_\-linux\-\_\-periodic\-\_\-task\-\_\-2(), and ui\-\_\-task().

\hypertarget{main_8c_a0f81e5b5621e6e2b2467daa7d12268c4}{\index{main.\-c@{main.\-c}!imu\-\_\-data@{imu\-\_\-data}}
\index{imu\-\_\-data@{imu\-\_\-data}!main.c@{main.\-c}}
\subsubsection[{imu\-\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}I\-M\-U\-\_\-\-D\-A\-T\-A\-\_\-\-S\-T\-R\-U\-T imu\-\_\-data}}\label{main_8c_a0f81e5b5621e6e2b2467daa7d12268c4}


Definition at line 20 of file main.\-c.



Referenced by control\-\_\-main(), and ui\-\_\-task().

\hypertarget{main_8c_a9c6b2109fb9402446f92995db60951b5}{\index{main.\-c@{main.\-c}!imu\-\_\-param@{imu\-\_\-param}}
\index{imu\-\_\-param@{imu\-\_\-param}!main.c@{main.\-c}}
\subsubsection[{imu\-\_\-param}]{\setlength{\rightskip}{0pt plus 5cm}{\bf I\-M\-U\-\_\-\-P\-A\-R\-A\-M\-\_\-\-S\-T\-R\-U\-C\-T} imu\-\_\-param}}\label{main_8c_a9c6b2109fb9402446f92995db60951b5}


Definition at line 16 of file main.\-c.

\hypertarget{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{\index{main.\-c@{main.\-c}!spi\-\_\-param@{spi\-\_\-param}}
\index{spi\-\_\-param@{spi\-\_\-param}!main.c@{main.\-c}}
\subsubsection[{spi\-\_\-param}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\-P\-I\-\_\-\-P\-A\-R\-A\-M\-\_\-\-S\-T\-R\-U\-C\-T} spi\-\_\-param}}\label{main_8c_adec2468b88cf50b20e5cf399a3b7e994}


Definition at line 17 of file main.\-c.

\hypertarget{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{\index{main.\-c@{main.\-c}!task1@{task1}}
\index{task1@{task1}!main.c@{main.\-c}}
\subsubsection[{task1}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\-A\-S\-K\-\_\-\-S} task1}}\label{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}


Main rotine for control\-: 

\begin{DoxyAuthor}{Author}
Rafael Lima 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\-1 
\end{DoxyVersion}


Definition at line 13 of file main.\-c.

\hypertarget{main_8c_a432cbf231acb83d48e31879bd7afc71a}{\index{main.\-c@{main.\-c}!task2@{task2}}
\index{task2@{task2}!main.c@{main.\-c}}
\subsubsection[{task2}]{\setlength{\rightskip}{0pt plus 5cm}{\bf T\-A\-S\-K\-\_\-\-S} task2}}\label{main_8c_a432cbf231acb83d48e31879bd7afc71a}


Definition at line 13 of file main.\-c.

\hypertarget{main_8c_ac7af894858cf396a219d632f40afdc8d}{\index{main.\-c@{main.\-c}!total@{total}}
\index{total@{total}!main.c@{main.\-c}}
\subsubsection[{total}]{\setlength{\rightskip}{0pt plus 5cm}int total = 0}}\label{main_8c_ac7af894858cf396a219d632f40afdc8d}


Definition at line 24 of file main.\-c.



Referenced by periodic\-\_\-task\-\_\-1(), periodic\-\_\-task\-\_\-2(), threads\-\_\-linux\-\_\-periodic\-\_\-task\-\_\-1(), threads\-\_\-linux\-\_\-periodic\-\_\-task\-\_\-2(), and ui\-\_\-task().

