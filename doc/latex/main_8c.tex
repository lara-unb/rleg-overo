\hypertarget{main_8c}{
\section{main.c File Reference}
\label{main_8c}\index{main.c@{main.c}}
}
{\ttfamily \#include $<$stdio.h$>$}\par
{\ttfamily \#include $<$math.h$>$}\par
{\ttfamily \#include \char`\"{}communication/communication.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}main.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}taskScheduler.h\char`\"{}}\par
Include dependency graph for main.c:This graph shows which files directly or indirectly include this file:\subsection*{Defines}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{main_8c_a065f7d947c9b50d14bac945e152e007a}{TASK\_\-UI\_\-PERIOD}~100000
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{main} (void)
\item 
static void \hyperlink{main_8c_ad6a9f022b4d089093836712320731f6a}{ui\_\-task} (int signo)
\item 
static void \hyperlink{main_8c_af2478600d5d8aaeda10d1eb1ce463919}{control\_\-task} (int signo)
\item 
int \hyperlink{main_8c_a5b2b1fdd5e517470c10e84a2b2bcc5c8}{get\_\-time} (double $\ast$time\_\-control\_\-task\_\-s, double $\ast$Ts\_\-control\_\-task\_\-s, double $\ast$mean\_\-time\_\-control\_\-task\_\-s, double $\ast$t0\_\-control\_\-task\_\-s)
\item 
void \hyperlink{main_8c_a5f05ce725141ddfab683e059b1cd95ea}{exit\_\-program} (void)
\begin{DoxyCompactList}\small\item\em Internal function to end program. \item\end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{structTASK__S}{TASK\_\-S} \hyperlink{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{task1}
\begin{DoxyCompactList}\small\item\em Main rotine for control: \item\end{DoxyCompactList}\item 
\hyperlink{structTASK__S}{TASK\_\-S} \hyperlink{main_8c_a432cbf231acb83d48e31879bd7afc71a}{task2}
\item 
\hyperlink{structIMU__PARAM__STRUCT}{IMU\_\-PARAM\_\-STRUCT} \hyperlink{main_8c_a9c6b2109fb9402446f92995db60951b5}{imu\_\-param}
\item 
\hyperlink{structSPI__PARAM__STRUCT}{SPI\_\-PARAM\_\-STRUCT} \hyperlink{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{spi\_\-param}
\item 
\hyperlink{structEFF__DATA__STRUCT}{EFF\_\-DATA\_\-STRUCT} \hyperlink{main_8c_a5650ece8c3a277c7f158d75ae65265fa}{eff\_\-data}
\item 
\hyperlink{structIMU__DATA__STRUCT}{IMU\_\-DATA\_\-STRUCT} \hyperlink{main_8c_a3cfea12cbe9ca7f1681c950e4cd68606}{imu\_\-data}
\item 
\hyperlink{structENC__DATA__STRUCT}{ENC\_\-DATA\_\-STRUCT} \hyperlink{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}{enc\_\-data}
\item 
\hyperlink{structMRA__DATA__STRUCT}{MRA\_\-DATA\_\-STRUCT} \hyperlink{main_8c_abc42e18d2909e9bc119316283f4ed9db}{mra\_\-data}
\item 
int \hyperlink{main_8c_ac7af894858cf396a219d632f40afdc8d}{total} = 0
\item 
int \hyperlink{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}{failure} = 0
\item 
int \hyperlink{main_8c_a95a859aa805a58cd4c59e172d250de4a}{acquire} = 0
\item 
int \hyperlink{main_8c_a9d28d012aca080b397aa05c88ee0e94c}{quittask} = 0
\item 
int \hyperlink{main_8c_a98046aa9aba5dbcc867be625185aef46}{t0} = 0
\end{DoxyCompactItemize}


\subsection{Define Documentation}
\hypertarget{main_8c_a065f7d947c9b50d14bac945e152e007a}{
\index{main.c@{main.c}!TASK\_\-UI\_\-PERIOD@{TASK\_\-UI\_\-PERIOD}}
\index{TASK\_\-UI\_\-PERIOD@{TASK\_\-UI\_\-PERIOD}!main.c@{main.c}}
\subsubsection[{TASK\_\-UI\_\-PERIOD}]{\setlength{\rightskip}{0pt plus 5cm}\#define TASK\_\-UI\_\-PERIOD~100000}}
\label{main_8c_a065f7d947c9b50d14bac945e152e007a}


Definition at line 19 of file main.c.



Referenced by main().



\subsection{Function Documentation}
\hypertarget{main_8c_af2478600d5d8aaeda10d1eb1ce463919}{
\index{main.c@{main.c}!control\_\-task@{control\_\-task}}
\index{control\_\-task@{control\_\-task}!main.c@{main.c}}
\subsubsection[{control\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}static void control\_\-task (int {\em signo})\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}
\label{main_8c_af2478600d5d8aaeda10d1eb1ce463919}


Definition at line 109 of file main.c.



References actuate(), failure, IMU\_\-PARAM\_\-STRUCT::i2c\_\-dev, read\_\-all\_\-data(), SPI\_\-PARAM\_\-STRUCT::spi\_\-dev, SUCCESS, TASK\_\-S::t\_\-global, total, and MRA\_\-DATA\_\-STRUCT::v\_\-ctl.



Referenced by main().




\begin{DoxyCode}
109                                    {
110   total++;
111 
112 /*Input*/
113   if(read_all_data(imu_param.i2c_dev, spi_param.spi_dev, &imu_data,&eff_data, &
      mra_data, &enc_data) != SUCCESS) failure++;
114   
115 /* Control */
116   mra_data.v_ctl=1275 + (uint8_t)(800*cosf(task1.t_global*1000));
117   //control_main(task1.t_global,&imu_data,&eff_data,&mra_data);
118 /* Actuate */
119   actuate(spi_param.spi_dev,&mra_data);
120 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:

\hypertarget{main_8c_a5f05ce725141ddfab683e059b1cd95ea}{
\index{main.c@{main.c}!exit\_\-program@{exit\_\-program}}
\index{exit\_\-program@{exit\_\-program}!main.c@{main.c}}
\subsubsection[{exit\_\-program}]{\setlength{\rightskip}{0pt plus 5cm}void exit\_\-program (void)}}
\label{main_8c_a5f05ce725141ddfab683e059b1cd95ea}


Internal function to end program. 



Definition at line 135 of file main.c.



Referenced by ui\_\-update().




\begin{DoxyCode}
135                        {
136   quittask = 1;
137   return;
138 }
\end{DoxyCode}




Here is the caller graph for this function:

\hypertarget{main_8c_a5b2b1fdd5e517470c10e84a2b2bcc5c8}{
\index{main.c@{main.c}!get\_\-time@{get\_\-time}}
\index{get\_\-time@{get\_\-time}!main.c@{main.c}}
\subsubsection[{get\_\-time}]{\setlength{\rightskip}{0pt plus 5cm}int get\_\-time (double $\ast$ {\em time\_\-control\_\-task\_\-s}, \/  double $\ast$ {\em Ts\_\-control\_\-task\_\-s}, \/  double $\ast$ {\em mean\_\-time\_\-control\_\-task\_\-s}, \/  double $\ast$ {\em t0\_\-control\_\-task\_\-s})}}
\label{main_8c_a5b2b1fdd5e517470c10e84a2b2bcc5c8}


Definition at line 122 of file main.c.



Referenced by ui\_\-overview\_\-data().




\begin{DoxyCode}
123 {
124   *time_control_task_s = task1.t_global;
125   *Ts_control_task_s = (task1.period_us)/1e6;
126   *mean_time_control_task_s = task1.T_mean_global;
127   *t0_control_task_s = t0;
128 
129   return SUCCESS;
130 }
\end{DoxyCode}




Here is the caller graph for this function:

\hypertarget{main_8c_a840291bc02cba5474a4cb46a9b9566fe}{
\index{main.c@{main.c}!main@{main}}
\index{main@{main}!main.c@{main.c}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (void)}}
\label{main_8c_a840291bc02cba5474a4cb46a9b9566fe}


Definition at line 39 of file main.c.



References IMU\_\-PARAM\_\-STRUCT::acc, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::act, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::clk\_\-source, control\_\-task(), SPI\_\-PARAM\_\-STRUCT::cs, devices\_\-init(), FAILURE, IMU\_\-PARAM\_\-STRUCT::param\_\-acc::full\_\-res, IMU\_\-PARAM\_\-STRUCT::gyr, IMU\_\-PARAM\_\-STRUCT::i2c\_\-dev, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::lpf\_\-bw, IMU\_\-PARAM\_\-STRUCT::mag, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::meas\_\-mode, SPI\_\-PARAM\_\-STRUCT::mode, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::op\_\-mode, quittask, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::range, IMU\_\-PARAM\_\-STRUCT::param\_\-acc::range, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::rate, IMU\_\-PARAM\_\-STRUCT::param\_\-gyr::rate, IMU\_\-PARAM\_\-STRUCT::param\_\-acc::rate, IMU\_\-PARAM\_\-STRUCT::param\_\-mag::samples\_\-avg, SPI\_\-PARAM\_\-STRUCT::speed, SPI\_\-PARAM\_\-STRUCT::spi\_\-dev, SUCCESS, TASK\_\-UI\_\-PERIOD, timer\_\-new\_\-task(), timer\_\-start\_\-task(), timer\_\-stop\_\-task(), ui\_\-close(), ui\_\-init(), and ui\_\-task().




\begin{DoxyCode}
39               {
40   int return_value = SUCCESS;
41 
42 /*Setting config values:*/
43   // Parameters for IMU
44   imu_param.acc.full_res=1;
45   imu_param.acc.rate=100;
46   imu_param.acc.range=16;
47   imu_param.gyr.rate=100;
48   imu_param.gyr.lpf_bw=188;
49   imu_param.gyr.clk_source='Z';
50   imu_param.gyr.act="XYZ";
51   imu_param.mag.rate=75;
52   imu_param.mag.range=0;
53   imu_param.mag.samples_avg=8;
54   imu_param.mag.meas_mode=0;
55   imu_param.mag.op_mode=0;
56 
57   // Parameters for SPI
58   spi_param.mode=0;
59   spi_param.speed=375000;
60   spi_param.cs=0;
61 
62   // Task for control UI:
63   timer_new_task(&task1,ui_task);
64   timer_new_task(&task2,control_task);
65   
66 /*Initialization:*/
67   if(devices_init(&imu_param,&spi_param,&mra_data)!=SUCCESS){
68     perror("Unsuccesful devices initialization");
69     return FAILURE;
70   }
71 
72   if(ui_init()!=SUCCESS){
73     perror("Unsuccesful user interface initialization");
74     return FAILURE;
75   }
76 
77   timer_start_task(&task1,TASK_UI_PERIOD);
78   //timer_start_task(task2);
79 
80 /* Main loop: */
81   while(quittask == 0){
82     //ui_task(0);
83   }
84 
85 /*Shutting Down:*/
86   timer_stop_task(&task1);
87   usleep(2000);
88   //timer_stop_task(&task2);
89 
90   if(ui_close()==FAILURE){
91     return_value = FAILURE;
92   }
93 
94   close(imu_param.i2c_dev);
95   close(spi_param.spi_dev);
96 
97   return return_value;
98 }
\end{DoxyCode}




Here is the call graph for this function:

\hypertarget{main_8c_ad6a9f022b4d089093836712320731f6a}{
\index{main.c@{main.c}!ui\_\-task@{ui\_\-task}}
\index{ui\_\-task@{ui\_\-task}!main.c@{main.c}}
\subsubsection[{ui\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}static void ui\_\-task (int {\em signo})\hspace{0.3cm}{\ttfamily  \mbox{[}static\mbox{]}}}}
\label{main_8c_ad6a9f022b4d089093836712320731f6a}


Definition at line 100 of file main.c.



References failure, IMU\_\-PARAM\_\-STRUCT::i2c\_\-dev, read\_\-all\_\-data(), SPI\_\-PARAM\_\-STRUCT::spi\_\-dev, SUCCESS, total, and ui\_\-update().



Referenced by main().




\begin{DoxyCode}
100                               {
101   total++;
102 
103   if(read_all_data(imu_param.i2c_dev, spi_param.spi_dev, &imu_data,&eff_data, &
      mra_data, &enc_data) != SUCCESS) failure++;
104 
105   ui_update(&imu_data, &eff_data, &mra_data,&enc_data, total, failure);
106 
107 }
\end{DoxyCode}




Here is the call graph for this function:



Here is the caller graph for this function:



\subsection{Variable Documentation}
\hypertarget{main_8c_a95a859aa805a58cd4c59e172d250de4a}{
\index{main.c@{main.c}!acquire@{acquire}}
\index{acquire@{acquire}!main.c@{main.c}}
\subsubsection[{acquire}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf acquire} = 0}}
\label{main_8c_a95a859aa805a58cd4c59e172d250de4a}


Definition at line 34 of file main.c.

\hypertarget{main_8c_a5650ece8c3a277c7f158d75ae65265fa}{
\index{main.c@{main.c}!eff\_\-data@{eff\_\-data}}
\index{eff\_\-data@{eff\_\-data}!main.c@{main.c}}
\subsubsection[{eff\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}{\bf EFF\_\-DATA\_\-STRUCT} {\bf eff\_\-data}}}
\label{main_8c_a5650ece8c3a277c7f158d75ae65265fa}


Definition at line 26 of file main.c.

\hypertarget{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}{
\index{main.c@{main.c}!enc\_\-data@{enc\_\-data}}
\index{enc\_\-data@{enc\_\-data}!main.c@{main.c}}
\subsubsection[{enc\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}{\bf ENC\_\-DATA\_\-STRUCT} {\bf enc\_\-data}}}
\label{main_8c_aaa441e18ae805c4f3efb0b5231d1cfe7}


Definition at line 28 of file main.c.

\hypertarget{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}{
\index{main.c@{main.c}!failure@{failure}}
\index{failure@{failure}!main.c@{main.c}}
\subsubsection[{failure}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf failure} = 0}}
\label{main_8c_a4f35e5ea2395561d0bd3b2f45612dc2c}


Definition at line 33 of file main.c.



Referenced by control\_\-task(), periodic\_\-task\_\-1(), periodic\_\-task\_\-2(), threads\_\-linux\_\-periodic\_\-task\_\-1(), threads\_\-linux\_\-periodic\_\-task\_\-2(), and ui\_\-task().

\hypertarget{main_8c_a3cfea12cbe9ca7f1681c950e4cd68606}{
\index{main.c@{main.c}!imu\_\-data@{imu\_\-data}}
\index{imu\_\-data@{imu\_\-data}!main.c@{main.c}}
\subsubsection[{imu\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}{\bf IMU\_\-DATA\_\-STRUCT} {\bf imu\_\-data}}}
\label{main_8c_a3cfea12cbe9ca7f1681c950e4cd68606}


Definition at line 27 of file main.c.



Referenced by control\_\-main().

\hypertarget{main_8c_a9c6b2109fb9402446f92995db60951b5}{
\index{main.c@{main.c}!imu\_\-param@{imu\_\-param}}
\index{imu\_\-param@{imu\_\-param}!main.c@{main.c}}
\subsubsection[{imu\_\-param}]{\setlength{\rightskip}{0pt plus 5cm}{\bf IMU\_\-PARAM\_\-STRUCT} {\bf imu\_\-param}}}
\label{main_8c_a9c6b2109fb9402446f92995db60951b5}


Definition at line 22 of file main.c.

\hypertarget{main_8c_abc42e18d2909e9bc119316283f4ed9db}{
\index{main.c@{main.c}!mra\_\-data@{mra\_\-data}}
\index{mra\_\-data@{mra\_\-data}!main.c@{main.c}}
\subsubsection[{mra\_\-data}]{\setlength{\rightskip}{0pt plus 5cm}{\bf MRA\_\-DATA\_\-STRUCT} {\bf mra\_\-data}}}
\label{main_8c_abc42e18d2909e9bc119316283f4ed9db}


Definition at line 29 of file main.c.



Referenced by control\_\-main().

\hypertarget{main_8c_a9d28d012aca080b397aa05c88ee0e94c}{
\index{main.c@{main.c}!quittask@{quittask}}
\index{quittask@{quittask}!main.c@{main.c}}
\subsubsection[{quittask}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf quittask} = 0}}
\label{main_8c_a9d28d012aca080b397aa05c88ee0e94c}


Definition at line 36 of file main.c.



Referenced by exit\_\-program(), main(), and threads\_\-linux\_\-init().

\hypertarget{main_8c_adec2468b88cf50b20e5cf399a3b7e994}{
\index{main.c@{main.c}!spi\_\-param@{spi\_\-param}}
\index{spi\_\-param@{spi\_\-param}!main.c@{main.c}}
\subsubsection[{spi\_\-param}]{\setlength{\rightskip}{0pt plus 5cm}{\bf SPI\_\-PARAM\_\-STRUCT} {\bf spi\_\-param}}}
\label{main_8c_adec2468b88cf50b20e5cf399a3b7e994}


Definition at line 23 of file main.c.

\hypertarget{main_8c_a98046aa9aba5dbcc867be625185aef46}{
\index{main.c@{main.c}!t0@{t0}}
\index{t0@{t0}!main.c@{main.c}}
\subsubsection[{t0}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf t0} = 0}}
\label{main_8c_a98046aa9aba5dbcc867be625185aef46}


Definition at line 37 of file main.c.



Referenced by get\_\-time(), periodic\_\-task\_\-1(), reset\_\-timer(), threads\_\-get\_\-time(), threads\_\-linux\_\-periodic\_\-task\_\-1(), threads\_\-linux\_\-periodic\_\-task\_\-2(), threads\_\-linux\_\-timer\_\-function\_\-task\_\-1(), threads\_\-reset\_\-timer(), timer\_\-function\_\-task\_\-1(), and ui\_\-overview\_\-data().

\hypertarget{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}{
\index{main.c@{main.c}!task1@{task1}}
\index{task1@{task1}!main.c@{main.c}}
\subsubsection[{task1}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TASK\_\-S} {\bf task1}}}
\label{main_8c_ab7d681ab68ca1c465fa993dd21ef096e}


Main rotine for control: 

\begin{DoxyAuthor}{Author}
Rafael Lima 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.1 
\end{DoxyVersion}


Definition at line 16 of file main.c.



Referenced by main().

\hypertarget{main_8c_a432cbf231acb83d48e31879bd7afc71a}{
\index{main.c@{main.c}!task2@{task2}}
\index{task2@{task2}!main.c@{main.c}}
\subsubsection[{task2}]{\setlength{\rightskip}{0pt plus 5cm}{\bf TASK\_\-S} {\bf task2}}}
\label{main_8c_a432cbf231acb83d48e31879bd7afc71a}


Definition at line 16 of file main.c.



Referenced by main().

\hypertarget{main_8c_ac7af894858cf396a219d632f40afdc8d}{
\index{main.c@{main.c}!total@{total}}
\index{total@{total}!main.c@{main.c}}
\subsubsection[{total}]{\setlength{\rightskip}{0pt plus 5cm}int {\bf total} = 0}}
\label{main_8c_ac7af894858cf396a219d632f40afdc8d}


Definition at line 32 of file main.c.



Referenced by control\_\-task(), periodic\_\-task\_\-1(), periodic\_\-task\_\-2(), threads\_\-linux\_\-periodic\_\-task\_\-1(), threads\_\-linux\_\-periodic\_\-task\_\-2(), and ui\_\-task().

