SUBDIRS = Communication
CC = arm-linux-gnueabi-gcc
CCLAGS = -Wall

SOURCES = main.c
HEADERS = $(wildcard *.h)
CLEANDIRS = $(SUBDIRS:%=clean-%)

#SOURCES = main.c
#OBJECTS = $(wildcard $(SUBDIRS)/*.o) main.o
#HEADERS = $(wildcard *.h)

#@echo Subdirs: $(SUBDIRS)

#EXECUTABLE = main


.PHONY: all
all: subdirs $(SOURCES) $(HEADERS) $(SUBDIRS) rleg

.PHONY: subdirs $(SUBDIRS)
subdirs: $(SUBDIRS)
$(SUBDIRS):
	@$(MAKE) -C $@
@echo Objects: $(OBJECTS)

OBJECTS = $(wildcard $(SUBDIRS)/*.o) main.o


rleg: $(OBJECTS) subdirs
	$(CC) $(CCFLAGS) $(OBJECTS) -o $@

main.o: main.c
	$(CC) $(CCFLAGS) -c main.c

.PHONY: print
print:
        @echo Sources: $(SOURCES)
        @echo Objects: $(OBJECTS)
      	@echo Headers: $(HEADERS)
        @echo Executable: rleg

        @echo Subdirs: $(SUBDIRS)
        @echo Cleandirs: $(CLEANDIRS)

.PHONY: subdirs $(CLEANDIRS)
clean: $(CLEANDIRS)
$(CLEANDIRS): 
	@$(MAKE) -C $(@:clean-%=%) clean
	-rm -f rleg *.o



